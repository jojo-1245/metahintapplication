<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í´ë¦¬ê³¤/ì´ë”ë¦¬ì›€ RPC í´ë¼ì´ì–¸íŠ¸ v3</title>
    <style>
        body { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; background-color: #f9fafb; color: #1f2937; padding: 2rem; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; background-color: white; padding: 1.5rem; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        h1 { font-size: 1.875rem; font-weight: 700; margin-bottom: 2rem; text-align: center; }
        h2 { font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.5rem; }
        h3 { font-size: 0.875rem; font-weight: 500; color: #4b5563; margin-top: 1rem; }
        label { display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.25rem; color: #374151; }
        input[type="text"], input[type="email"], input[type="password"], input[type="tel"], select { width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); margin-top: 0.25rem; box-sizing: border-box; }
        input:focus, select:focus { outline: none; border-color: #4f46e5; box-shadow: 0 0 0 3px rgb(99 102 241 / 0.2); }
        button { display: inline-flex; justify-content: center; align-items: center; padding: 0.6rem 1rem; border: none; border-radius: 0.375rem; font-weight: 500; font-size: 0.875rem; cursor: pointer; transition: background-color 0.2s ease-in-out; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background-color: #4f46e5; color: white; } .btn-primary:hover:not(:disabled) { background-color: #4338ca; }
        .btn-secondary { background-color: #6b7280; color: white; } .btn-secondary:hover:not(:disabled) { background-color: #4b5563; }
        .btn-success { background-color: #16a34a; color: white; } .btn-success:hover:not(:disabled) { background-color: #15803d; }
        .btn-danger { background-color: #dc2626; color: white; } .btn-danger:hover:not(:disabled) { background-color: #b91c1c; }
        .btn-warning { background-color: #f59e0b; color: white; } .btn-warning:hover:not(:disabled) { background-color: #d97706; }
        .btn-info { background-color: #0891b2; color: white; } .btn-info:hover:not(:disabled) { background-color: #0e7490; }
        .btn-full { width: 100%; } .btn-flex-1 { flex: 1 1 0%; }
        .grid-container { display: grid; grid-template-columns: repeat(1, minmax(0, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem; }
        @media (min-width: 1024px) { .grid-container { grid-template-columns: repeat(3, minmax(0, 1fr)); } } /* lg breakpoint 3ì—´ */
        @media (min-width: 768px) and (max-width: 1023px) { .grid-container { grid-template-columns: repeat(2, minmax(0, 1fr)); } } /* md breakpoint 2ì—´ */
        .section { border: 1px solid #e5e7eb; padding: 1rem; border-radius: 0.5rem; background-color: #f9fafb; display: flex; flex-direction: column; gap: 1.5rem; }
        .section-item { } .section-item-bordered { border-top: 1px solid #e5e7eb; padding-top: 1.5rem; }
        .flex-container { display: flex; gap: 0.5rem; }
        .hidden { display: none; }
        .text-sm { font-size: 0.875rem; } .text-xs { font-size: 0.75rem; }
        .text-red-600 { color: #dc2626; } .text-blue-600 { color: #2563eb; } .text-green-600 { color: #16a34a; }
        .text-gray-500 { color: #6b7280; } .font-medium { font-weight: 500; } .font-semibold { font-weight: 600; } .font-bold { font-weight: 700; }
        .font-mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
        .break-all { word-break: break-all; }
        .mt-1 { margin-top: 0.25rem; } .mt-2 { margin-top: 0.5rem; } .mt-4 { margin-top: 1rem; }
        .mb-1 { margin-bottom: 0.25rem; } .mb-2 { margin-bottom: 0.5rem; } .mb-3 { margin-bottom: 0.75rem; } .mb-4 { margin-bottom: 1rem; } .mb-6 { margin-bottom: 1.5rem; } .mb-8 { margin-bottom: 2rem; }
        .p-4 { padding: 1rem; } .pt-3 { padding-top: 0.75rem; } .pt-6 { padding-top: 1.5rem; }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; display: none; margin-left: 8px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        pre { background-color: #e5e7eb; border-radius: 0.375rem; padding: 0.5rem; font-size: 0.75rem; color: #1f2937; margin-top: 0.5rem; white-space: pre-wrap; word-break: break-all; max-height: 15rem; overflow-y: auto; } /* Max height ëŠ˜ë¦¼ */
        #commonLog { background-color: #1f2937; color: #f9fafb; height: 10rem; }
    </style>
</head>
<body>
    <div class="container">
        <h1>í´ë¦¬ê³¤/ì´ë”ë¦¬ì›€ RPC í´ë¼ì´ì–¸íŠ¸ v3</h1>

        <div class="mb-6">
            <label for="serverUrl">ì„œë²„ RPC ì—”ë“œí¬ì¸íŠ¸:</label>
            <input type="text" id="serverUrl" value="http://localhost:3000/rpc" class="input-style">
        </div>

        <div class="mb-6 p-4" style="background-color: #eff6ff; border: 1px solid #bfdbfe; border-radius: 0.375rem;">
            <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem; color: #1e40af;">ì¸ì¦ ìƒíƒœ</h3>
            <p class="text-sm text-gray-500">ë¡œê·¸ì¸ ìƒíƒœ: <span id="loginStatus" class="font-medium text-red-600">ë¡œê·¸ì•„ì›ƒ</span></p>
            <p class="text-sm text-gray-500">ì¸ì¦ í† í°: <span id="authTokenDisplay" class="font-mono text-xs break-all">ì—†ìŒ</span></p>
            <p class="text-sm text-gray-500">ì‚¬ìš©ì ID: <span id="userIdDisplay" class="font-medium">ì—†ìŒ</span></p>
            <p class="text-sm text-gray-500">ì§€ê°‘ ì£¼ì†Œ: <span id="userAddressDisplay" class="font-mono text-xs break-all">ì—†ìŒ</span></p>
        </div>

        <div class="grid-container">

            <div class="section">
                <div class="section-item">
                    <h2>ì‚¬ìš©ì ë“±ë¡</h2>
                    <form id="registerForm">
                        <div><label for="regName">ì´ë¦„:</label><input type="text" id="regName" required></div>
                        <div><label for="regPhone">ì „í™”ë²ˆí˜¸ (ì„ íƒ):</label><input type="tel" id="regPhone"></div>
                        <div class="section-item-bordered">
                             <label for="regEmail">ì´ë©”ì¼:</label>
                             <div class="flex-container"><input type="email" id="regEmail" required style="flex: 1 1 0%;"><button type="button" id="requestCodeButton" class="btn-secondary" style="padding: 0.5rem 0.75rem; font-size: 0.875rem;">ì¸ì¦ ìš”ì²­ <div class="loader" id="requestCodeLoader"></div></button></div>
                        </div>
                        <div id="verificationSection" class="section-item-bordered hidden">
                            <p id="verificationStatus" class="text-sm text-blue-600">ì´ë©”ì¼ í™•ì¸ í›„ ì¸ì¦ë²ˆí˜¸ ì…ë ¥</p>
                            <label for="regVerificationCode">ì¸ì¦ë²ˆí˜¸ (4ìë¦¬):</label>
                            <div class="flex-container"><input type="text" id="regVerificationCode" maxlength="4" pattern="\d{4}" required placeholder="1234" style="flex: 1 1 0%;"><button type="button" id="verifyCodeButton" class="btn-primary" style="padding: 0.5rem 0.75rem; font-size: 0.875rem;">ë²ˆí˜¸ í™•ì¸ <div class="loader" id="verifyCodeLoader"></div></button></div>
                        </div>
                        <div><label for="regPassword">ë¹„ë°€ë²ˆí˜¸:</label><input type="password" id="regPassword" required></div>
                        <button type="submit" id="registerSubmitButton" disabled class="btn btn-success btn-full">ê°€ì… ì™„ë£Œ <div class="loader" id="registerLoader"></div></button>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">ë“±ë¡ ê²°ê³¼:</h3><pre id="registerResult"></pre></div>
                </div>
                <div class="section-item-bordered">
                    <h2>ì‚¬ìš©ì ë¡œê·¸ì¸</h2>
                    <form id="loginForm">
                        <div><label for="loginEmail">ì´ë©”ì¼:</label><input type="email" id="loginEmail" required></div>
                        <div><label for="loginPassword">ë¹„ë°€ë²ˆí˜¸:</label><input type="password" id="loginPassword" required></div>
                        <button type="submit" class="btn btn-primary btn-full">ë¡œê·¸ì¸ <div class="loader" id="loginLoader"></div></button>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">ë¡œê·¸ì¸ ê²°ê³¼:</h3><pre id="loginResult"></pre></div>
                </div>
                 <div class="section-item-bordered">
                    <h2>ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •</h2>
                    <form id="resetPasswordRequestForm">
                         <div>
                             <label for="resetEmail">ê°€ì…ëœ ì´ë©”ì¼ ì£¼ì†Œ:</label>
                             <div class="flex-container">
                                <input type="email" id="resetEmail" required class="flex-1">
                                <button type="submit" id="requestResetCodeButton" class="btn-secondary" style="padding: 0.5rem 0.75rem; font-size: 0.875rem;">ì½”ë“œ ìš”ì²­ <div class="loader" id="resetCodeRequestLoader"></div></button>
                             </div>
                         </div>
                    </form>
                    <div id="resetVerificationSection" class="mt-4 border-t pt-3 space-y-3 hidden">
                         <p id="resetVerificationStatus" class="text-sm text-blue-600">ì´ë©”ì¼ë¡œ ë°œì†¡ëœ ì½”ë“œë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
                         <form id="resetPasswordForm">
                             <div><label for="resetCode">ì¸ì¦ë²ˆí˜¸ (4ìë¦¬):</label><input type="text" id="resetCode" maxlength="4" pattern="\d{4}" required placeholder="1234"></div>
                             <div><label for="resetNewPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸:</label><input type="password" id="resetNewPassword" required></div>
                             <button type="submit" id="resetPasswordButton" class="btn btn-primary btn-full">ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • <div class="loader" id="resetPasswordLoader"></div></button>
                         </form>
                    </div>
                     <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">ì¬ì„¤ì • ê²°ê³¼:</h3><pre id="resetResult"></pre></div>
                </div>
            </div>

            <div class="section">
                <div class="section-item">
                    <h2>ì”ì•¡ ì¡°íšŒ (eth_getBalance)</h2>
                    <form id="balanceForm">
                        <div><label for="balanceAddress">ì§€ê°‘ ì£¼ì†Œ:</label><input type="text" id="balanceAddress" required placeholder="0x..."></div>
                        <div><label for="balanceNetwork">ë„¤íŠ¸ì›Œí¬:</label>
                            <select id="balanceNetwork">
                                <option value="polygon" selected>Polygon Mainnet</option>
                                <option value="ethereum">Ethereum Mainnet</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-warning btn-full">ì”ì•¡ ì¡°íšŒ <div class="loader" id="balanceLoader"></div></button>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">ì”ì•¡ ê²°ê³¼:</h3><pre id="balanceResult"></pre></div>
                </div>
                 <div class="section-item-bordered">
                    <h2>í† í° ì •ë³´ ì¡°íšŒ (getTokenInfo)</h2>
                    <form id="tokenInfoForm">
                        <div><label for="tokenInfoContractAddress">í† í° ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œ:</label><input type="text" id="tokenInfoContractAddress" required placeholder="0x..."></div>
                        <div><label for="tokenInfoNetwork">ë„¤íŠ¸ì›Œí¬:</label>
                            <select id="tokenInfoNetwork">
                                <option value="polygon" selected>Polygon Mainnet</option>
                                <option value="ethereum">Ethereum Mainnet</option>
                            </select>
                        </div>
                        <button type="submit" id="getTokenInfoButton" class="btn btn-info btn-full">ì •ë³´ ì¡°íšŒ <div class="loader" id="tokenInfoLoader"></div></button>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">í† í° ì •ë³´ ê²°ê³¼:</h3><pre id="tokenInfoResult"></pre></div>
                </div>
                <div class="section-item-bordered">
                    <h2>ERC20 í† í° ì”ì•¡ ì¡°íšŒ</h2>
                    <p class="text-xs text-red-600 mb-3">* ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
                    <form id="erc20BalanceForm">
                        <div><label for="erc20BalanceContractAddress">í† í° ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œ:</label><input type="text" id="erc20BalanceContractAddress" required placeholder="0x..."></div>
                        <div><label for="erc20BalanceNetwork">ë„¤íŠ¸ì›Œí¬:</label>
                            <select id="erc20BalanceNetwork">
                                <option value="polygon" selected>Polygon Mainnet</option>
                                <option value="ethereum">Ethereum Mainnet</option>
                            </select>
                        </div>
                        <button type="submit" id="getErc20BalanceButton" disabled class="btn btn-info btn-full">í† í° ì”ì•¡ ì¡°íšŒ <div class="loader" id="erc20BalanceLoader"></div></button>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">í† í° ì”ì•¡ ê²°ê³¼:</h3><pre id="erc20BalanceResult"></pre></div>
                </div>
                 <div class="section-item-bordered">
                    <h2>ì§€ê°‘ ì”ì•¡ ë™ì‹œ ì¡°íšŒ</h2>
                    <form id="walletBalancesForm">
                         <div><label for="walletBalancesAddress">ì¡°íšŒí•  ì§€ê°‘ ì£¼ì†Œ:</label><input type="text" id="walletBalancesAddress" required placeholder="0x..."></div>
                        <div><label for="walletBalancesContractAddress">í† í° ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œ:</label><input type="text" id="walletBalancesContractAddress" required placeholder="0x..."></div>
                        <div><label for="walletBalancesNetwork">ë„¤íŠ¸ì›Œí¬:</label>
                            <select id="walletBalancesNetwork">
                                <option value="polygon" selected>Polygon Mainnet</option>
                                <option value="ethereum">Ethereum Mainnet</option>
                            </select>
                        </div>
                        <button type="submit" id="getWalletBalancesButton" class="btn btn-success btn-full">ì”ì•¡ ë™ì‹œ ì¡°íšŒ <div class="loader" id="walletBalancesLoader"></div></button>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">ë™ì‹œ ì¡°íšŒ ê²°ê³¼:</h3><pre id="walletBalancesResult"></pre></div>
                </div>
                 <div class="section-item-bordered">
                    <h2>ìŠ¤í† ì–´ ì—…ë°ì´íŠ¸ ì •ë³´ í™•ì¸</h2>
                    <button type="button" id="getStoreInfoButton" class="btn btn-secondary btn-full">ì •ë³´ í™•ì¸ <div class="loader" id="storeInfoLoader"></div></button>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">ìŠ¤í† ì–´ ì •ë³´:</h3><pre id="storeInfoResult"></pre></div>
                </div>
                <div class="section-item-bordered">
                    <h2>íŠ¸ëœì­ì…˜ ìƒì„¸ ì •ë³´ ì¡°íšŒ</h2>
                    <form id="txDetailsForm">
                        <div><label for="txHashInput">íŠ¸ëœì­ì…˜ í•´ì‹œ:</label><input type="text" id="txHashInput" required placeholder="0x..."></div>
                        <div><label for="txDetailsNetworkSelect">ë„¤íŠ¸ì›Œí¬:</label>
                            <select id="txDetailsNetworkSelect">
                                <option value="polygon" selected>Polygon Mainnet</option>
                                <option value="ethereum">Ethereum Mainnet</option>
                            </select>
                        </div>
                        <button type="submit" id="getTxDetailsButton" class="btn btn-info btn-full">ìƒì„¸ ì •ë³´ ì¡°íšŒ <div class="loader" id="txDetailsLoader"></div></button>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">íŠ¸ëœì­ì…˜ ìƒì„¸ ì •ë³´:</h3><pre id="txDetailsResult"></pre></div>
                </div>
            </div>

            <div class="section">
                <div class="section-item">
                    <h2>ë„¤ì´í‹°ë¸Œ ì½”ì¸ ì „ì†¡</h2>
                    <p class="text-xs text-red-600 mb-3">* ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
                    <form id="txForm">
                        <div><label for="txTo">ë°›ëŠ” ì£¼ì†Œ:</label><input type="text" id="txTo" required></div>
                        <div><label for="txValue">ë³´ë‚¼ ê¸ˆì•¡ (ETH/MATIC):</label><input type="text" id="txValue" required placeholder="ì˜ˆ: 1.5"></div>
                        <div><label for="txNetwork">ë„¤íŠ¸ì›Œí¬:</label>
                            <select id="txNetwork">
                                <option value="polygon" selected>Polygon Mainnet</option>
                                <option value="ethereum">Ethereum Mainnet</option>
                            </select>
                        </div>
                        <div class="flex-container mt-2">
                            <button type="button" id="estimateNativeFeeButton" disabled class="btn-secondary btn-flex-1" style="font-size: 0.8rem;">ì˜ˆìƒ ìˆ˜ìˆ˜ë£Œ <div class="loader" id="nativeFeeLoader"></div></button>
                            <button type="submit" id="sendTxButton" disabled class="btn-primary btn-flex-1" style="font-size: 0.8rem;">ì „ì†¡í•˜ê¸° <div class="loader" id="txLoader"></div></button>
                        </div>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">ì˜ˆìƒ ìˆ˜ìˆ˜ë£Œ:</h3><pre id="nativeFeeResult"></pre></div>
                    <div class="mt-2"><h3 class="text-sm font-medium text-gray-600">ì „ì†¡ ê²°ê³¼ (Tx í•´ì‹œ):</h3><pre id="txResult"></pre></div>
                </div>
                 <div class="section-item-bordered">
                    <h2>ERC20 í† í° ì „ì†¡</h2>
                    <p class="text-xs text-red-600 mb-3">* ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
                    <form id="erc20Form">
                        <div><label for="erc20ContractAddress">í† í° ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œ:</label><input type="text" id="erc20ContractAddress" required placeholder="0x..."></div>
                        <div><label for="erc20ToAddress">ë°›ëŠ” ì£¼ì†Œ:</label><input type="text" id="erc20ToAddress" required placeholder="0x..."></div>
                        <div><label for="erc20Amount">ë³´ë‚¼ ìˆ˜ëŸ‰ (í† í° ë‹¨ìœ„):</label><input type="text" id="erc20Amount" required placeholder="ì˜ˆ: 10.5"><p class="mt-1 text-xs text-gray-500">ì„œë²„ì—ì„œ ì†Œìˆ˜ì ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p></div>
                        <div><label for="erc20Network">ë„¤íŠ¸ì›Œí¬:</label>
                            <select id="erc20Network">
                                <option value="polygon" selected>Polygon Mainnet</option>
                                <option value="ethereum">Ethereum Mainnet</option>
                            </select>
                        </div>
                        <div class="flex-container mt-2">
                            <button type="button" id="estimateErc20FeeButton" disabled class="btn-secondary btn-flex-1" style="font-size: 0.8rem;">ì˜ˆìƒ ìˆ˜ìˆ˜ë£Œ <div class="loader" id="erc20FeeLoader"></div></button>
                            <button type="submit" id="sendErc20Button" disabled class="btn-primary btn-flex-1" style="font-size: 0.8rem;">ERC20 ì „ì†¡ <div class="loader" id="erc20Loader"></div></button>
                        </div>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">ì˜ˆìƒ ìˆ˜ìˆ˜ë£Œ:</h3><pre id="erc20FeeResult"></pre></div>
                    <div class="mt-2"><h3 class="text-sm font-medium text-gray-600">ì „ì†¡ ê²°ê³¼ (Tx í•´ì‹œ):</h3><pre id="erc20Result"></pre></div>
                </div>
                 <div class="section-item-bordered">
                    <h2>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h2>
                    <p class="text-xs text-red-600 mb-3">* ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
                    <form id="changePasswordForm">
                        <div><label for="currentPassword">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸:</label><input type="password" id="currentPassword" required></div>
                        <div><label for="newPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸:</label><input type="password" id="newPassword" required></div>
                        <div><label for="confirmNewPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸:</label><input type="password" id="confirmNewPassword" required></div>
                        <button type="submit" id="changePasswordButton" disabled class="btn btn-primary btn-full">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ <div class="loader" id="changePasswordLoader"></div></button>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">ë³€ê²½ ê²°ê³¼:</h3><pre id="changePasswordResult"></pre></div>
                </div>
                 <div class="section-item-bordered" style="background-color: #fee2e2; border-color: #fca5a5; padding: 1rem; border-radius: 0.5rem;">
                    <h2 style="color: #991b1b;">ê°œì¸í‚¤ ì¡°íšŒ</h2>
                    <p style="color: #b91c1c;" class="text-sm font-medium mb-3">âš ï¸ ë³´ì•ˆ ê²½ê³ : ê°œë°œ/í…ŒìŠ¤íŠ¸ìš© ê¸°ëŠ¥ì…ë‹ˆë‹¤.</p>
                    <p class="text-xs text-red-600 mb-3">* ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
                    <div id="privateKeySection">
                         <button type="button" id="getPrivateKeyButton" disabled class="btn btn-danger w-full md:w-auto">ë‚´ ì§€ê°‘ ì •ë³´ ì¡°íšŒ (ìœ„í—˜!) <div class="loader" id="privateKeyLoader"></div></button>
                    </div>
                     <div class="mt-4">
                        <h3 class="text-sm font-medium text-gray-600">ê²°ê³¼ (ì§€ê°‘ ì£¼ì†Œ & ê°œì¸í‚¤):</h3>
                        <pre id="privateKeyResult"></pre>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-6 border border-gray-200 p-4 rounded-lg bg-gray-50">
             <h2 class="text-lg font-semibold mb-2 text-gray-700">ë¡œê·¸ / ì˜¤ë¥˜ ë©”ì‹œì§€</h2>
             <pre id="commonLog"></pre>
        </div>
    </div>

    <script>
        // --- ì „ì—­ ìƒíƒœ ë³€ìˆ˜ ---
        let currentRequestId = 1;
        let authToken = null;
        let currentUserId = null;
        let currentUserAddress = null;

        // --- DOMContentLoaded ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
        document.addEventListener('DOMContentLoaded', () => {

            // --- DOM ìš”ì†Œ ìºì‹± ---
            const getEl = (id) => document.getElementById(id);
            const elements = {
                serverUrlInput: getEl('serverUrl'),
                loginStatusEl: getEl('loginStatus'),
                authTokenEl: getEl('authTokenDisplay'),
                userIdEl: getEl('userIdDisplay'),
                userAddressEl: getEl('userAddressDisplay'),
                // Forms & Sections
                registerForm: getEl('registerForm'),
                loginForm: getEl('loginForm'),
                balanceForm: getEl('balanceForm'),
                tokenInfoForm: getEl('tokenInfoForm'),
                txForm: getEl('txForm'),
                erc20Form: getEl('erc20Form'),
                erc20BalanceForm: getEl('erc20BalanceForm'),
                walletBalancesForm: getEl('walletBalancesForm'),
                changePasswordForm: getEl('changePasswordForm'),
                resetPasswordRequestForm: getEl('resetPasswordRequestForm'),
                resetPasswordForm: getEl('resetPasswordForm'),
                txDetailsForm: getEl('txDetailsForm'), // *** ì¶”ê°€ë¨ ***
                verificationSection: getEl('verificationSection'),
                resetVerificationSection: getEl('resetVerificationSection'),
                // Inputs & Status
                regNameInput: getEl('regName'), regPhoneInput: getEl('regPhone'), regEmailInput: getEl('regEmail'), regPasswordInput: getEl('regPassword'),
                verificationStatus: getEl('verificationStatus'), regVerificationCodeInput: getEl('regVerificationCode'),
                loginEmailInput: getEl('loginEmail'), loginPasswordInput: getEl('loginPassword'),
                balanceAddressInput: getEl('balanceAddress'), balanceNetworkSelect: getEl('balanceNetwork'),
                tokenInfoContractAddressInput: getEl('tokenInfoContractAddress'), tokenInfoNetworkSelect: getEl('tokenInfoNetwork'),
                txToInput: getEl('txTo'), txValueInput: getEl('txValue'), txNetworkSelect: getEl('txNetwork'),
                erc20ContractAddressInput: getEl('erc20ContractAddress'), erc20ToAddressInput: getEl('erc20ToAddress'), erc20AmountInput: getEl('erc20Amount'), erc20NetworkSelect: getEl('erc20Network'),
                erc20BalanceContractAddressInput: getEl('erc20BalanceContractAddress'), erc20BalanceNetworkSelect: getEl('erc20BalanceNetwork'),
                walletBalancesAddressInput: getEl('walletBalancesAddress'), walletBalancesContractAddressInput: getEl('walletBalancesContractAddress'), walletBalancesNetworkSelect: getEl('walletBalancesNetwork'),
                currentPasswordInput: getEl('currentPassword'), newPasswordInput: getEl('newPassword'), confirmNewPasswordInput: getEl('confirmNewPassword'),
                resetEmailInput: getEl('resetEmail'), resetVerificationStatus: getEl('resetVerificationStatus'), resetCodeInput: getEl('resetCode'), resetNewPasswordInput: getEl('resetNewPassword'),
                txHashInput: getEl('txHashInput'), // *** ì¶”ê°€ë¨ ***
                txDetailsNetworkSelect: getEl('txDetailsNetworkSelect'), // *** ì¶”ê°€ë¨ ***
                // Result Elements
                registerResultEl: getEl('registerResult'), loginResultEl: getEl('loginResult'), balanceResultEl: getEl('balanceResult'),
                tokenInfoResultEl: getEl('tokenInfoResult'), txResultEl: getEl('txResult'), erc20ResultEl: getEl('erc20Result'),
                nativeFeeResultEl: getEl('nativeFeeResult'), erc20FeeResultEl: getEl('erc20FeeResult'), erc20BalanceResultEl: getEl('erc20BalanceResult'),
                privateKeyResultEl: getEl('privateKeyResult'), walletBalancesResultEl: getEl('walletBalancesResult'), changePasswordResultEl: getEl('changePasswordResult'),
                resetResultEl: getEl('resetResult'), storeInfoResultEl: getEl('storeInfoResult'),
                txDetailsResultEl: getEl('txDetailsResult'), // *** ì¶”ê°€ë¨ ***
                commonLogEl: getEl('commonLog'),
                // Buttons
                requestCodeButton: getEl('requestCodeButton'), verifyCodeButton: getEl('verifyCodeButton'), registerSubmitButton: getEl('registerSubmitButton'),
                sendTxButton: getEl('sendTxButton'), sendErc20Button: getEl('sendErc20Button'), estimateNativeFeeButton: getEl('estimateNativeFeeButton'),
                estimateErc20FeeButton: getEl('estimateErc20FeeButton'), getTokenInfoButton: getEl('getTokenInfoButton'), getErc20BalanceButton: getEl('getErc20BalanceButton'),
                getPrivateKeyButton: getEl('getPrivateKeyButton'), getWalletBalancesButton: getEl('getWalletBalancesButton'), changePasswordButton: getEl('changePasswordButton'),
                requestResetCodeButton: getEl('requestResetCodeButton'), resetPasswordButton: getEl('resetPasswordButton'), getStoreInfoButton: getEl('getStoreInfoButton'),
                getTxDetailsButton: getEl('getTxDetailsButton'), // *** ì¶”ê°€ë¨ ***
                // Loaders
                loaders: {
                    register: getEl('registerLoader'), login: getEl('loginLoader'), balance: getEl('balanceLoader'),
                    tokenInfo: getEl('tokenInfoLoader'), tx: getEl('txLoader'), erc20: getEl('erc20Loader'),
                    nativeFee: getEl('nativeFeeLoader'), erc20Fee: getEl('erc20FeeLoader'), requestCode: getEl('requestCodeLoader'),
                    verifyCode: getEl('verifyCodeLoader'), erc20Balance: getEl('erc20BalanceLoader'), privateKey: getEl('privateKeyLoader'),
                    walletBalances: getEl('walletBalancesLoader'), changePassword: getEl('changePasswordLoader'),
                    resetCodeRequest: getEl('resetCodeRequestLoader'), resetPassword: getEl('resetPasswordLoader'),
                    storeInfo: getEl('storeInfoLoader'), txDetails: getEl('txDetailsLoader'), // *** ì¶”ê°€ë¨ ***
                }
            };

            // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
            const toggleLoader = (loaderName, show) => { const loaderElement = elements.loaders[loaderName]; if (loaderElement) { loaderElement.style.display = show ? 'inline-block' : 'none'; } };
            const logMessage = (message, isError = false) => { if (!elements.commonLogEl) return; const timestamp = new Date().toLocaleTimeString(); const logEntry = document.createElement('div'); logEntry.textContent = `[${timestamp}] ${message}`; if (isError) logEntry.style.color = '#ef4444'; elements.commonLogEl.appendChild(logEntry); elements.commonLogEl.scrollTop = elements.commonLogEl.scrollHeight; };
            const clearResult = (element) => { if (element) element.textContent = ''; };
            const clearAllResults = () => { Object.values(elements).forEach(el => { if (el && el.tagName === 'PRE') clearResult(el); }); };
            const formatFeeDisplay = (feeData) => { if (!feeData || !feeData.totalFeeWei) return 'N/A'; try { const feeWei = BigInt(feeData.totalFeeWei); const feeEther = Number(feeWei) / 1e18; return `Gas: ${feeData.estimatedGas}\nPrice: ${feeData.gasPrice} Wei\nTotal: ${feeData.totalFeeWei} Wei\n(${feeEther.toFixed(8)} ETH/MATIC)`; } catch (e) { return 'ê²°ê³¼ í‘œì‹œ ì˜¤ë¥˜'; } };
            const formatBalance = (balanceWei, decimals) => { try { const balanceBigInt = BigInt(balanceWei); const decimalsNumber = Number(decimals); if (decimalsNumber === 0) return balanceBigInt.toString(); const factor = 10n ** BigInt(decimalsNumber); const integerPart = balanceBigInt / factor; const fractionalPart = (balanceBigInt % factor).toString().padStart(decimalsNumber, '0').replace(/0+$/, ''); return fractionalPart === '' ? integerPart.toString() : `${integerPart}.${fractionalPart}`; } catch (e) { console.error("Error formatting balance:", e); return "ë³€í™˜ ì˜¤ë¥˜"; } };

            const updateAuthStatusUI = () => {
                const isLoggedIn = !!authToken;
                elements.loginStatusEl.textContent = isLoggedIn ? 'ë¡œê·¸ì¸ë¨' : 'ë¡œê·¸ì•„ì›ƒ';
                elements.loginStatusEl.classList.toggle('text-green-600', isLoggedIn);
                elements.loginStatusEl.classList.toggle('text-red-600', !isLoggedIn);
                elements.authTokenEl.textContent = authToken || 'ì—†ìŒ';
                elements.userIdEl.textContent = currentUserId || 'ì—†ìŒ';
                elements.userAddressEl.textContent = currentUserAddress || 'ì—†ìŒ';
                // ë¡œê·¸ì¸ í•„ìš”í•œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                elements.sendTxButton.disabled = !isLoggedIn;
                elements.sendErc20Button.disabled = !isLoggedIn;
                elements.estimateNativeFeeButton.disabled = !isLoggedIn;
                elements.estimateErc20FeeButton.disabled = !isLoggedIn;
                elements.getErc20BalanceButton.disabled = !isLoggedIn;
                elements.getPrivateKeyButton.disabled = !isLoggedIn;
                elements.changePasswordButton.disabled = !isLoggedIn;
            };

            // --- í•µì‹¬ RPC í†µì‹  í•¨ìˆ˜ ---
            async function sendRpcRequest(method, params = [], loaderName = null) {
                const serverUrl = elements.serverUrlInput.value; if (!serverUrl) { logMessage('ì„œë²„ URLì´ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', true); throw new Error('Server URL is not set.'); } const requestId = currentRequestId++; const requestBody = { jsonrpc: '2.0', method: method, params: params, id: requestId }; logMessage(`ìš”ì²­ ë³´ëƒ„ (ID: ${requestId}, Method: ${method}): ${JSON.stringify(params)}`); if(loaderName) toggleLoader(loaderName, true); try { const response = await fetch(serverUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(requestBody) }); const responseData = await response.json(); if (!response.ok) { const errorMsg = responseData.error ? responseData.error.message : `HTTP ì˜¤ë¥˜ ${response.status}`; throw new Error(errorMsg); } if (responseData.error) { logMessage(`RPC ì˜¤ë¥˜ (ID: ${requestId}, Code: ${responseData.error.code}): ${responseData.error.message}`, true); throw new Error(`RPC Error (${responseData.error.code}): ${responseData.error.message}`); } logMessage(`ì‘ë‹µ ë°›ìŒ (ID: ${requestId}): ${JSON.stringify(responseData.result)}`); return responseData.result; } catch (error) { logMessage(`ìš”ì²­ ì‹¤íŒ¨ (ID: ${requestId}): ${error.message}`, true); throw error; } finally { if(loaderName) toggleLoader(loaderName, false); }
            }

            // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ---

            // ì‚¬ìš©ì ë“±ë¡ ê´€ë ¨
            elements.requestCodeButton.addEventListener('click', async () => {
                const email = elements.regEmailInput.value; if (!email || !/\S+@\S+\.\S+/.test(email)) { logMessage('ìœ íš¨í•œ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.', true); clearResult(elements.registerResultEl); elements.registerResultEl.textContent = 'ì˜¤ë¥˜: ìœ íš¨í•œ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.'; return; } clearResult(elements.registerResultEl); elements.verificationStatus.textContent = 'ì¸ì¦ë²ˆí˜¸ ìš”ì²­ ì¤‘...'; elements.verificationStatus.className = 'text-sm text-blue-600'; try { const result = await sendRpcRequest('requestEmailVerification', [email], 'requestCode'); logMessage(result.message || 'ì¸ì¦ë²ˆí˜¸ ìš”ì²­ ì„±ê³µ (ì´ë©”ì¼ í™•ì¸)'); elements.verificationSection.classList.remove('hidden'); elements.verificationStatus.textContent = 'ì´ë©”ì¼ë¡œ ë°œì†¡ëœ ì¸ì¦ë²ˆí˜¸ë¥¼ í™•ì¸ í›„ ì…ë ¥í•˜ì„¸ìš”.'; elements.requestCodeButton.disabled = true; elements.verifyCodeButton.disabled = false; elements.regVerificationCodeInput.disabled = false; elements.registerSubmitButton.disabled = true; } catch (error) { elements.registerResultEl.textContent = `ì˜¤ë¥˜: ${error.message}`; elements.verificationStatus.textContent = 'ì¸ì¦ë²ˆí˜¸ ìš”ì²­ ì‹¤íŒ¨.'; elements.verificationStatus.className = 'text-sm text-red-600'; }
            });
            elements.verifyCodeButton.addEventListener('click', async () => {
                const email = elements.regEmailInput.value; const code = elements.regVerificationCodeInput.value; if (!code || code.length !== 4 || !/^\d{4}$/.test(code)) { logMessage('4ìë¦¬ ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', true); clearResult(elements.registerResultEl); elements.registerResultEl.textContent = 'ì˜¤ë¥˜: 4ìë¦¬ ìˆ«ìë¡œ ëœ ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'; return; } clearResult(elements.registerResultEl); elements.verificationStatus.textContent = 'ì¸ì¦ë²ˆí˜¸ í™•ì¸ ì¤‘...'; elements.verificationStatus.className = 'text-sm text-blue-600'; try { const result = await sendRpcRequest('verifyEmailCode', [email, code], 'verifyCode'); logMessage(result.message || 'ì´ë©”ì¼ ì¸ì¦ ì„±ê³µ!'); elements.verificationStatus.textContent = 'âœ… ì´ë©”ì¼ ì¸ì¦ ì™„ë£Œ!'; elements.verificationStatus.className = 'text-sm text-green-600'; elements.registerSubmitButton.disabled = false; elements.regVerificationCodeInput.disabled = true; elements.verifyCodeButton.disabled = true; elements.requestCodeButton.disabled = true; } catch (error) { elements.registerResultEl.textContent = `ì˜¤ë¥˜: ${error.message}`; elements.verificationStatus.textContent = 'ì¸ì¦ë²ˆí˜¸ í™•ì¸ ì‹¤íŒ¨.'; elements.verificationStatus.className = 'text-sm text-red-600'; elements.registerSubmitButton.disabled = true; }
            });
            elements.registerForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.registerResultEl); const name = elements.regNameInput.value; const phone = elements.regPhoneInput.value; const email = elements.regEmailInput.value; const password = elements.regPasswordInput.value; try { const result = await sendRpcRequest('register', [name, phone, email, password], 'register'); elements.registerResultEl.textContent = JSON.stringify(result, null, 2); logMessage('ì‚¬ìš©ì ë“±ë¡ ìµœì¢… ì„±ê³µ!'); if(result.publicAddress) elements.balanceAddressInput.value = result.publicAddress; elements.verificationSection.classList.add('hidden'); elements.requestCodeButton.disabled = false; elements.regVerificationCodeInput.value = ''; elements.regVerificationCodeInput.disabled = true; elements.verifyCodeButton.disabled = true; elements.registerSubmitButton.disabled = true; elements.verificationStatus.textContent = ''; } catch (error) { elements.registerResultEl.textContent = `ì˜¤ë¥˜: ${error.message}`; elements.registerSubmitButton.disabled = true; }
            });

            // ì‚¬ìš©ì ë¡œê·¸ì¸
            elements.loginForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.loginResultEl); const email = elements.loginEmailInput.value; const password = elements.loginPasswordInput.value; try { const result = await sendRpcRequest('login', [email, password], 'login'); elements.loginResultEl.textContent = JSON.stringify(result, null, 2); if (result.success && result.token) { authToken = result.token; currentUserId = result.userId; currentUserAddress = null; logMessage(`ë¡œê·¸ì¸ ì„±ê³µ! í† í°: ${authToken}`); try { const walletInfo = await sendRpcRequest('getPrivateKey', [authToken]); if(walletInfo.publicAddress) { currentUserAddress = walletInfo.publicAddress; logMessage('ì‚¬ìš©ì ì§€ê°‘ ì£¼ì†Œ í™•ì¸ë¨.'); } } catch (walletError) { logMessage('ë¡œê·¸ì¸ ì‚¬ìš©ìì˜ ì§€ê°‘ ì£¼ì†Œë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.', true); } updateAuthStatusUI(); } else { authToken = null; currentUserId = null; currentUserAddress = null; updateAuthStatusUI(); } } catch (error) { elements.loginResultEl.textContent = `ì˜¤ë¥˜: ${error.message}`; authToken = null; currentUserId = null; currentUserAddress = null; updateAuthStatusUI(); }
            });

            // ì”ì•¡ ì¡°íšŒ
            elements.balanceForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.balanceResultEl); const address = elements.balanceAddressInput.value; const network = elements.balanceNetworkSelect.value; try { const result = await sendRpcRequest('eth_getBalance', [address, 'latest', network], 'balance'); const balanceInEther = formatBalance(result, 18); elements.balanceResultEl.textContent = `${result} Wei\n(${balanceInEther} ETH/MATIC)`; logMessage(`${address}ì˜ ì”ì•¡ ì¡°íšŒ ì„±ê³µ (${network})`); } catch (error) { elements.balanceResultEl.textContent = `ì˜¤ë¥˜: ${error.message}`; }
            });

            // í† í° ì •ë³´ ì¡°íšŒ
            elements.tokenInfoForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.tokenInfoResultEl); const contractAddress = elements.tokenInfoContractAddressInput.value; const network = elements.tokenInfoNetworkSelect.value; try { const result = await sendRpcRequest('getTokenInfo', [contractAddress, network], 'tokenInfo'); elements.tokenInfoResultEl.textContent = `Name: ${result.name}\nSymbol: ${result.symbol}\nDecimals: ${result.decimals}`; logMessage(`í† í° ì •ë³´ ì¡°íšŒ ì„±ê³µ (${contractAddress} on ${network})`); } catch (error) { elements.tokenInfoResultEl.textContent = `ì˜¤ë¥˜: ${error.message}`; }
            });

            // ë„¤ì´í‹°ë¸Œ ì½”ì¸ ì „ì†¡
            elements.txForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.txResultEl); if (!authToken) { logMessage('ë¡œê·¸ì¸ í•„ìš”', true); elements.txResultEl.textContent = 'ì˜¤ë¥˜: ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'; return; } const to = elements.txToInput.value; const valueEth = elements.txValueInput.value; const network = elements.txNetworkSelect.value; let valueWei; try { valueWei = parseUnits(valueEth, 18).toString(); } catch (err) { logMessage('ê¸ˆì•¡ ë³€í™˜ ì˜¤ë¥˜: '+err.message, true); elements.txResultEl.textContent = 'ì˜¤ë¥˜: ìœ íš¨ ê¸ˆì•¡ ì•„ë‹˜.'; return; } const txObject = { to: to, value: valueWei }; try { const result = await sendRpcRequest('eth_sendTransaction', [txObject, network, authToken, false], 'tx'); elements.txResultEl.textContent = `Tx í•´ì‹œ: ${result}`; logMessage(`ë„¤ì´í‹°ë¸Œ ì½”ì¸ ì „ì†¡ ì„±ê³µ (${network}), í•´ì‹œ: ${result}`); } catch (error) { elements.txResultEl.textContent = `ì˜¤ë¥˜: ${error.message}`; }
            });

            // ë„¤ì´í‹°ë¸Œ ì½”ì¸ ìˆ˜ìˆ˜ë£Œ ì˜ˆì¸¡
            elements.estimateNativeFeeButton.addEventListener('click', async () => {
                clearResult(elements.nativeFeeResultEl); if (!authToken) { logMessage('ë¡œê·¸ì¸ í•„ìš”', true); elements.nativeFeeResultEl.textContent = 'ì˜¤ë¥˜: ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'; return; } const to = elements.txToInput.value; const valueEth = elements.txValueInput.value; const network = elements.txNetworkSelect.value; if (!to || !valueEth) { elements.nativeFeeResultEl.textContent = 'ì˜¤ë¥˜: ë°›ëŠ” ì£¼ì†Œì™€ ê¸ˆì•¡ ì…ë ¥ í•„ìš”.'; return; } try { const result = await sendRpcRequest('estimateNativeFee', [to, valueEth, network, authToken], 'nativeFee'); elements.nativeFeeResultEl.textContent = formatFeeDisplay(result); logMessage(`ë„¤ì´í‹°ë¸Œ ì½”ì¸ ì˜ˆìƒ ìˆ˜ìˆ˜ë£Œ ì¡°íšŒ ì„±ê³µ (${network})`); } catch (error) { elements.nativeFeeResultEl.textContent = `ì˜¤ë¥˜: ${error.message}`; }
            });

            // ERC20 í† í° ì „ì†¡
            elements.erc20Form.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.erc20ResultEl); if (!authToken) { logMessage('ë¡œê·¸ì¸ í•„ìš”', true); elements.erc20ResultEl.textContent = 'ì˜¤ë¥˜: ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'; return; } const contractAddress = elements.erc20ContractAddressInput.value; const toAddress = elements.erc20ToAddressInput.value; const amountString = elements.erc20AmountInput.value; const network = elements.erc20NetworkSelect.value; try { const result = await sendRpcRequest('sendErc20Token', [contractAddress, toAddress, amountString, network, authToken], 'erc20'); elements.erc20ResultEl.textContent = `Tx í•´ì‹œ: ${result}`; logMessage(`ERC20 í† í° ì „ì†¡ ì„±ê³µ (${network}), í•´ì‹œ: ${result}`); } catch (error) { elements.erc20ResultEl.textContent = `ì˜¤ë¥˜: ${error.message}`; }
            });

            // ERC20 í† í° ìˆ˜ìˆ˜ë£Œ ì˜ˆì¸¡
            elements.estimateErc20FeeButton.addEventListener('click', async () => {
                clearResult(elements.erc20FeeResultEl); if (!authToken) { logMessage('ë¡œê·¸ì¸ í•„ìš”', true); elements.erc20FeeResultEl.textContent = 'ì˜¤ë¥˜: ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'; return; } const contractAddress = elements.erc20ContractAddressInput.value; const toAddress = elements.erc20ToAddressInput.value; const amountString = elements.erc20AmountInput.value; const network = elements.erc20NetworkSelect.value; if (!contractAddress || !toAddress || !amountString) { elements.erc20FeeResultEl.textContent = 'ì˜¤ë¥˜: ëª¨ë“  í•„ë“œ ì…ë ¥ í•„ìš”.'; return; } try { const result = await sendRpcRequest('estimateErc20Fee', [contractAddress, toAddress, amountString, network, authToken], 'erc20Fee'); elements.erc20FeeResultEl.textContent = formatFeeDisplay(result); logMessage(`ERC20 í† í° ì˜ˆìƒ ìˆ˜ìˆ˜ë£Œ ì¡°íšŒ ì„±ê³µ (${network})`); } catch (error) { elements.erc20FeeResultEl.textContent = `ì˜¤ë¥˜: ${error.message}`; }
            });

            // ERC20 í† í° ì”ì•¡ ì¡°íšŒ
            elements.erc20BalanceForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.erc20BalanceResultEl); if (!authToken) { logMessage('ë¡œê·¸ì¸ í•„ìš”', true); elements.erc20BalanceResultEl.textContent = 'ì˜¤ë¥˜: ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'; return; } const contractAddress = elements.erc20BalanceContractAddressInput.value; const network = elements.erc20BalanceNetworkSelect.value; try { const result = await sendRpcRequest('getErc20Balance', [contractAddress, network, authToken], 'erc20Balance'); const formattedBal = formatBalance(result.balanceWei, result.decimals); elements.erc20BalanceResultEl.textContent = `Decimals: ${result.decimals}\nBalance (Wei): ${result.balanceWei}\nFormatted: ${formattedBal}`; logMessage(`ERC20 í† í° ì”ì•¡ ì¡°íšŒ ì„±ê³µ (${contractAddress} on ${network})`); } catch (error) { elements.erc20BalanceResultEl.textContent = `ì˜¤ë¥˜: ${error.message}`; }
            });

            // ì§€ê°‘ ì”ì•¡ ë™ì‹œ ì¡°íšŒ
            elements.walletBalancesForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.walletBalancesResultEl); const walletAddress = elements.walletBalancesAddressInput.value; const contractAddress = elements.walletBalancesContractAddressInput.value; const network = elements.walletBalancesNetworkSelect.value; if (!walletAddress || !contractAddress) { elements.walletBalancesResultEl.textContent = 'ì˜¤ë¥˜: ì¡°íšŒí•  ì§€ê°‘ ì£¼ì†Œì™€ í† í° ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.'; return; } try { const result = await sendRpcRequest('getWalletBalances', [walletAddress, contractAddress, network], 'walletBalances'); const nativeFormatted = formatBalance(result.nativeBalanceWei, 18); const tokenFormatted = formatBalance(result.tokenBalanceWei, result.tokenDecimals); elements.walletBalancesResultEl.textContent = `Native Balance: ${nativeFormatted} (Wei: ${result.nativeBalanceWei})\nToken Balance: ${tokenFormatted} (Wei: ${result.tokenBalanceWei}, Decimals: ${result.tokenDecimals})`; logMessage(`ì§€ê°‘ ì”ì•¡ ë™ì‹œ ì¡°íšŒ ì„±ê³µ (Address: ${walletAddress}, Token: ${contractAddress} on ${network})`); } catch (error) { elements.walletBalancesResultEl.textContent = `ì˜¤ë¥˜: ${error.message}`; }
            });

            // ê°œì¸í‚¤ ì¡°íšŒ
            elements.getPrivateKeyButton.addEventListener('click', async () => {
                clearResult(elements.privateKeyResultEl); if (!authToken) { logMessage('ë¡œê·¸ì¸ í•„ìš”', true); elements.privateKeyResultEl.textContent = 'ì˜¤ë¥˜: ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'; return; } if (!confirm('ğŸš¨ ë³´ì•ˆ ê²½ê³ ! ê°œì¸í‚¤ë¥¼ ì¡°íšŒí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ í‚¤ëŠ” ì ˆëŒ€ë¡œ íƒ€ì¸ê³¼ ê³µìœ í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.')) { return; } try { const result = await sendRpcRequest('getPrivateKey', [authToken], 'privateKey'); elements.privateKeyResultEl.textContent = `Address: ${result.publicAddress || 'N/A'}\nPrivate Key: ${result.privateKey || 'N/A'}`; console.warn("ğŸš¨ SECURITY WARNING: Private key retrieved!", result.privateKey); logMessage('ê°œì¸í‚¤ ì¡°íšŒ ì™„ë£Œ (ë³´ì•ˆì— ê°ë³„íˆ ì£¼ì˜í•˜ì„¸ìš”).'); } catch (error) { elements.privateKeyResultEl.textContent = `ì˜¤ë¥˜: ${error.message}`; }
            });

            // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
            elements.changePasswordForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.changePasswordResultEl); if (!authToken) { logMessage('ë¡œê·¸ì¸ í•„ìš”', true); elements.changePasswordResultEl.textContent = 'ì˜¤ë¥˜: ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'; return; } const currentPassword = elements.currentPasswordInput.value; const newPassword = elements.newPasswordInput.value; const confirmNewPassword = elements.confirmNewPasswordInput.value; if (!currentPassword || !newPassword || !confirmNewPassword) { elements.changePasswordResultEl.textContent = 'ì˜¤ë¥˜: ëª¨ë“  ë¹„ë°€ë²ˆí˜¸ í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.'; return; } if (newPassword !== confirmNewPassword) { elements.changePasswordResultEl.textContent = 'ì˜¤ë¥˜: ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'; return; } try { const result = await sendRpcRequest('changePassword', [currentPassword, newPassword, authToken], 'changePassword'); elements.changePasswordResultEl.textContent = result.message || 'ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.'; logMessage('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì„±ê³µ'); elements.currentPasswordInput.value = ''; elements.newPasswordInput.value = ''; elements.confirmNewPasswordInput.value = ''; } catch (error) { elements.changePasswordResultEl.textContent = `ì˜¤ë¥˜: ${error.message}`; }
            });

            // ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì½”ë“œ ìš”ì²­
            elements.resetPasswordRequestForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.resetResultEl); const email = elements.resetEmailInput.value; if (!email || !/\S+@\S+\.\S+/.test(email)) { logMessage('ìœ íš¨í•œ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.', true); elements.resetResultEl.textContent = 'ì˜¤ë¥˜: ìœ íš¨í•œ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.'; return; } elements.resetVerificationStatus.textContent = 'ì¬ì„¤ì • ì½”ë“œ ìš”ì²­ ì¤‘...'; elements.resetVerificationSection.classList.add('hidden'); try { const result = await sendRpcRequest('requestPasswordReset', [email], 'resetCodeRequest'); logMessage(result.message || 'ì¬ì„¤ì • ì½”ë“œ ìš”ì²­ ì„±ê³µ (ì´ë©”ì¼ í™•ì¸)'); elements.resetVerificationSection.classList.remove('hidden'); elements.resetVerificationStatus.textContent = 'ì´ë©”ì¼ë¡œ ë°œì†¡ëœ ì½”ë“œë¥¼ í™•ì¸ í›„ ì•„ë˜ì— ì…ë ¥í•˜ì„¸ìš”.'; elements.resetVerificationStatus.className = 'text-sm text-blue-600'; elements.requestResetCodeButton.disabled = true; } catch (error) { elements.resetResultEl.textContent = `ì˜¤ë¥˜: ${error.message}`; elements.resetVerificationStatus.textContent = 'ì½”ë“œ ìš”ì²­ ì‹¤íŒ¨.'; elements.resetVerificationStatus.className = 'text-sm text-red-600'; }
            });

             // ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì‹¤í–‰
            elements.resetPasswordForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.resetResultEl); const email = elements.resetEmailInput.value; const code = elements.resetCodeInput.value; const newPassword = elements.resetNewPasswordInput.value; if (!email || !code || !newPassword || code.length !== 4 || !/^\d{4}$/.test(code)) { elements.resetResultEl.textContent = 'ì˜¤ë¥˜: ì´ë©”ì¼, 4ìë¦¬ ì½”ë“œ, ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.'; return; } try { const result = await sendRpcRequest('resetPassword', [email, code, newPassword], 'resetPassword'); elements.resetResultEl.textContent = result.message || 'ë¹„ë°€ë²ˆí˜¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì¬ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.'; logMessage('ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì„±ê³µ'); elements.resetVerificationSection.classList.add('hidden'); elements.resetCodeInput.value = ''; elements.resetNewPasswordInput.value = ''; elements.resetEmailInput.value = ''; elements.requestResetCodeButton.disabled = false; } catch (error) { elements.resetResultEl.textContent = `ì˜¤ë¥˜: ${error.message}`; }
            });

            // ìŠ¤í† ì–´ ì •ë³´ ì¡°íšŒ
            elements.getStoreInfoButton.addEventListener('click', async () => {
                clearResult(elements.storeInfoResultEl);
                try {
                    const result = await sendRpcRequest('isupdatedstore', [], 'storeInfo');
                    const statusText = result.isNewStore ? 'ìƒˆ ìŠ¤í† ì–´ ì‚¬ìš© ê°€ëŠ¥ (ì—…ë°ì´íŠ¸ í•„ìš”)' : 'ìµœì‹  ë²„ì „ ì‚¬ìš© ì¤‘';
                    elements.storeInfoResultEl.textContent = `ìƒíƒœ: ${statusText}\nìƒˆ URL: ${result.newUrl || '(ì—†ìŒ)'}`;
                    logMessage('ìŠ¤í† ì–´ ì—…ë°ì´íŠ¸ ì •ë³´ ì¡°íšŒ ì„±ê³µ');
                } catch (error) {
                    elements.storeInfoResultEl.textContent = `ì˜¤ë¥˜: ${error.message}`;
                }
            });

            // *** íŠ¸ëœì­ì…˜ ìƒì„¸ ì •ë³´ ì¡°íšŒ ì¶”ê°€ ***
            elements.txDetailsForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                clearResult(elements.txDetailsResultEl);
                const txHash = elements.txHashInput.value;
                const network = elements.txDetailsNetworkSelect.value;
                if (!txHash || !txHash.startsWith('0x') || txHash.length !== 66) {
                     elements.txDetailsResultEl.textContent = 'ì˜¤ë¥˜: ìœ íš¨í•œ íŠ¸ëœì­ì…˜ í•´ì‹œë¥¼ ì…ë ¥í•˜ì„¸ìš” (0xë¡œ ì‹œì‘í•˜ëŠ” 66ì).';
                     return;
                }
                try {
                    const result = await sendRpcRequest('getTransactionDetails', [txHash, network], 'txDetails');
                    if (result === null) {
                        elements.txDetailsResultEl.textContent = 'íŠ¸ëœì­ì…˜ ë˜ëŠ” ì˜ìˆ˜ì¦ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                    } else {
                        // ê²°ê³¼ ê°ì²´ë¥¼ ë³´ê¸° ì¢‹ê²Œ ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ í‘œì‹œ
                        elements.txDetailsResultEl.textContent = JSON.stringify(result, null, 2);
                    }
                    logMessage(`íŠ¸ëœì­ì…˜ ìƒì„¸ ì •ë³´ ì¡°íšŒ ì„±ê³µ (${txHash} on ${network})`);
                } catch (error) {
                    elements.txDetailsResultEl.textContent = `ì˜¤ë¥˜: ${error.message}`;
                }
            });


            // --- ì´ˆê¸°í™” ---
            updateAuthStatusUI();
            logMessage('í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ.');

        }); // *** DOMContentLoaded ë¦¬ìŠ¤ë„ˆ ë‹«ê¸° ***
    </script>
</body>
</html>
