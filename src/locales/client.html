<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>폴리곤/이더리움 RPC 클라이언트 v3</title>
    <style>
        body { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; background-color: #f9fafb; color: #1f2937; padding: 2rem; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; background-color: white; padding: 1.5rem; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        h1 { font-size: 1.875rem; font-weight: 700; margin-bottom: 2rem; text-align: center; }
        h2 { font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.5rem; }
        h3 { font-size: 0.875rem; font-weight: 500; color: #4b5563; margin-top: 1rem; }
        label { display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.25rem; color: #374151; }
        input[type="text"], input[type="email"], input[type="password"], input[type="tel"], select { width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); margin-top: 0.25rem; box-sizing: border-box; }
        input:focus, select:focus { outline: none; border-color: #4f46e5; box-shadow: 0 0 0 3px rgb(99 102 241 / 0.2); }
        button { display: inline-flex; justify-content: center; align-items: center; padding: 0.6rem 1rem; border: none; border-radius: 0.375rem; font-weight: 500; font-size: 0.875rem; cursor: pointer; transition: background-color 0.2s ease-in-out; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background-color: #4f46e5; color: white; } .btn-primary:hover:not(:disabled) { background-color: #4338ca; }
        .btn-secondary { background-color: #6b7280; color: white; } .btn-secondary:hover:not(:disabled) { background-color: #4b5563; }
        .btn-success { background-color: #16a34a; color: white; } .btn-success:hover:not(:disabled) { background-color: #15803d; }
        .btn-danger { background-color: #dc2626; color: white; } .btn-danger:hover:not(:disabled) { background-color: #b91c1c; }
        .btn-warning { background-color: #f59e0b; color: white; } .btn-warning:hover:not(:disabled) { background-color: #d97706; }
        .btn-info { background-color: #0891b2; color: white; } .btn-info:hover:not(:disabled) { background-color: #0e7490; }
        .btn-full { width: 100%; } .btn-flex-1 { flex: 1 1 0%; }
        .grid-container { display: grid; grid-template-columns: repeat(1, minmax(0, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem; }
        @media (min-width: 1024px) { .grid-container { grid-template-columns: repeat(3, minmax(0, 1fr)); } } /* lg breakpoint 3열 */
        @media (min-width: 768px) and (max-width: 1023px) { .grid-container { grid-template-columns: repeat(2, minmax(0, 1fr)); } } /* md breakpoint 2열 */
        .section { border: 1px solid #e5e7eb; padding: 1rem; border-radius: 0.5rem; background-color: #f9fafb; display: flex; flex-direction: column; gap: 1.5rem; }
        .section-item { } .section-item-bordered { border-top: 1px solid #e5e7eb; padding-top: 1.5rem; }
        .flex-container { display: flex; gap: 0.5rem; }
        .hidden { display: none; }
        .text-sm { font-size: 0.875rem; } .text-xs { font-size: 0.75rem; }
        .text-red-600 { color: #dc2626; } .text-blue-600 { color: #2563eb; } .text-green-600 { color: #16a34a; }
        .text-gray-500 { color: #6b7280; } .font-medium { font-weight: 500; } .font-semibold { font-weight: 600; } .font-bold { font-weight: 700; }
        .font-mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
        .break-all { word-break: break-all; }
        .mt-1 { margin-top: 0.25rem; } .mt-2 { margin-top: 0.5rem; } .mt-4 { margin-top: 1rem; }
        .mb-1 { margin-bottom: 0.25rem; } .mb-2 { margin-bottom: 0.5rem; } .mb-3 { margin-bottom: 0.75rem; } .mb-4 { margin-bottom: 1rem; } .mb-6 { margin-bottom: 1.5rem; } .mb-8 { margin-bottom: 2rem; }
        .p-4 { padding: 1rem; } .pt-3 { padding-top: 0.75rem; } .pt-6 { padding-top: 1.5rem; }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; display: none; margin-left: 8px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        pre { background-color: #e5e7eb; border-radius: 0.375rem; padding: 0.5rem; font-size: 0.75rem; color: #1f2937; margin-top: 0.5rem; white-space: pre-wrap; word-break: break-all; max-height: 15rem; overflow-y: auto; } /* Max height 늘림 */
        #commonLog { background-color: #1f2937; color: #f9fafb; height: 10rem; }
    </style>
</head>
<body>
    <div class="container">
        <h1>폴리곤/이더리움 RPC 클라이언트 v3</h1>

        <div class="mb-6">
            <label for="serverUrl">서버 RPC 엔드포인트:</label>
            <input type="text" id="serverUrl" value="http://localhost:3000/rpc" class="input-style">
        </div>

        <div class="mb-6 p-4" style="background-color: #eff6ff; border: 1px solid #bfdbfe; border-radius: 0.375rem;">
            <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem; color: #1e40af;">인증 상태</h3>
            <p class="text-sm text-gray-500">로그인 상태: <span id="loginStatus" class="font-medium text-red-600">로그아웃</span></p>
            <p class="text-sm text-gray-500">인증 토큰: <span id="authTokenDisplay" class="font-mono text-xs break-all">없음</span></p>
            <p class="text-sm text-gray-500">사용자 ID: <span id="userIdDisplay" class="font-medium">없음</span></p>
            <p class="text-sm text-gray-500">지갑 주소: <span id="userAddressDisplay" class="font-mono text-xs break-all">없음</span></p>
        </div>

        <div class="grid-container">

            <div class="section">
                <div class="section-item">
                    <h2>사용자 등록</h2>
                    <form id="registerForm">
                        <div><label for="regName">이름:</label><input type="text" id="regName" required></div>
                        <div><label for="regPhone">전화번호 (선택):</label><input type="tel" id="regPhone"></div>
                        <div class="section-item-bordered">
                             <label for="regEmail">이메일:</label>
                             <div class="flex-container"><input type="email" id="regEmail" required style="flex: 1 1 0%;"><button type="button" id="requestCodeButton" class="btn-secondary" style="padding: 0.5rem 0.75rem; font-size: 0.875rem;">인증 요청 <div class="loader" id="requestCodeLoader"></div></button></div>
                        </div>
                        <div id="verificationSection" class="section-item-bordered hidden">
                            <p id="verificationStatus" class="text-sm text-blue-600">이메일 확인 후 인증번호 입력</p>
                            <label for="regVerificationCode">인증번호 (4자리):</label>
                            <div class="flex-container"><input type="text" id="regVerificationCode" maxlength="4" pattern="\d{4}" required placeholder="1234" style="flex: 1 1 0%;"><button type="button" id="verifyCodeButton" class="btn-primary" style="padding: 0.5rem 0.75rem; font-size: 0.875rem;">번호 확인 <div class="loader" id="verifyCodeLoader"></div></button></div>
                        </div>
                        <div><label for="regPassword">비밀번호:</label><input type="password" id="regPassword" required></div>
                        <button type="submit" id="registerSubmitButton" disabled class="btn btn-success btn-full">가입 완료 <div class="loader" id="registerLoader"></div></button>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">등록 결과:</h3><pre id="registerResult"></pre></div>
                </div>
                <div class="section-item-bordered">
                    <h2>사용자 로그인</h2>
                    <form id="loginForm">
                        <div><label for="loginEmail">이메일:</label><input type="email" id="loginEmail" required></div>
                        <div><label for="loginPassword">비밀번호:</label><input type="password" id="loginPassword" required></div>
                        <button type="submit" class="btn btn-primary btn-full">로그인 <div class="loader" id="loginLoader"></div></button>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">로그인 결과:</h3><pre id="loginResult"></pre></div>
                </div>
                 <div class="section-item-bordered">
                    <h2>비밀번호 재설정</h2>
                    <form id="resetPasswordRequestForm">
                         <div>
                             <label for="resetEmail">가입된 이메일 주소:</label>
                             <div class="flex-container">
                                <input type="email" id="resetEmail" required class="flex-1">
                                <button type="submit" id="requestResetCodeButton" class="btn-secondary" style="padding: 0.5rem 0.75rem; font-size: 0.875rem;">코드 요청 <div class="loader" id="resetCodeRequestLoader"></div></button>
                             </div>
                         </div>
                    </form>
                    <div id="resetVerificationSection" class="mt-4 border-t pt-3 space-y-3 hidden">
                         <p id="resetVerificationStatus" class="text-sm text-blue-600">이메일로 발송된 코드를 확인하세요.</p>
                         <form id="resetPasswordForm">
                             <div><label for="resetCode">인증번호 (4자리):</label><input type="text" id="resetCode" maxlength="4" pattern="\d{4}" required placeholder="1234"></div>
                             <div><label for="resetNewPassword">새 비밀번호:</label><input type="password" id="resetNewPassword" required></div>
                             <button type="submit" id="resetPasswordButton" class="btn btn-primary btn-full">비밀번호 재설정 <div class="loader" id="resetPasswordLoader"></div></button>
                         </form>
                    </div>
                     <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">재설정 결과:</h3><pre id="resetResult"></pre></div>
                </div>
            </div>

            <div class="section">
                <div class="section-item">
                    <h2>잔액 조회 (eth_getBalance)</h2>
                    <form id="balanceForm">
                        <div><label for="balanceAddress">지갑 주소:</label><input type="text" id="balanceAddress" required placeholder="0x..."></div>
                        <div><label for="balanceNetwork">네트워크:</label>
                            <select id="balanceNetwork">
                                <option value="polygon" selected>Polygon Mainnet</option>
                                <option value="ethereum">Ethereum Mainnet</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-warning btn-full">잔액 조회 <div class="loader" id="balanceLoader"></div></button>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">잔액 결과:</h3><pre id="balanceResult"></pre></div>
                </div>
                 <div class="section-item-bordered">
                    <h2>토큰 정보 조회 (getTokenInfo)</h2>
                    <form id="tokenInfoForm">
                        <div><label for="tokenInfoContractAddress">토큰 컨트랙트 주소:</label><input type="text" id="tokenInfoContractAddress" required placeholder="0x..."></div>
                        <div><label for="tokenInfoNetwork">네트워크:</label>
                            <select id="tokenInfoNetwork">
                                <option value="polygon" selected>Polygon Mainnet</option>
                                <option value="ethereum">Ethereum Mainnet</option>
                            </select>
                        </div>
                        <button type="submit" id="getTokenInfoButton" class="btn btn-info btn-full">정보 조회 <div class="loader" id="tokenInfoLoader"></div></button>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">토큰 정보 결과:</h3><pre id="tokenInfoResult"></pre></div>
                </div>
                <div class="section-item-bordered">
                    <h2>ERC20 토큰 잔액 조회</h2>
                    <p class="text-xs text-red-600 mb-3">* 로그인이 필요합니다.</p>
                    <form id="erc20BalanceForm">
                        <div><label for="erc20BalanceContractAddress">토큰 컨트랙트 주소:</label><input type="text" id="erc20BalanceContractAddress" required placeholder="0x..."></div>
                        <div><label for="erc20BalanceNetwork">네트워크:</label>
                            <select id="erc20BalanceNetwork">
                                <option value="polygon" selected>Polygon Mainnet</option>
                                <option value="ethereum">Ethereum Mainnet</option>
                            </select>
                        </div>
                        <button type="submit" id="getErc20BalanceButton" disabled class="btn btn-info btn-full">토큰 잔액 조회 <div class="loader" id="erc20BalanceLoader"></div></button>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">토큰 잔액 결과:</h3><pre id="erc20BalanceResult"></pre></div>
                </div>
                 <div class="section-item-bordered">
                    <h2>지갑 잔액 동시 조회</h2>
                    <form id="walletBalancesForm">
                         <div><label for="walletBalancesAddress">조회할 지갑 주소:</label><input type="text" id="walletBalancesAddress" required placeholder="0x..."></div>
                        <div><label for="walletBalancesContractAddress">토큰 컨트랙트 주소:</label><input type="text" id="walletBalancesContractAddress" required placeholder="0x..."></div>
                        <div><label for="walletBalancesNetwork">네트워크:</label>
                            <select id="walletBalancesNetwork">
                                <option value="polygon" selected>Polygon Mainnet</option>
                                <option value="ethereum">Ethereum Mainnet</option>
                            </select>
                        </div>
                        <button type="submit" id="getWalletBalancesButton" class="btn btn-success btn-full">잔액 동시 조회 <div class="loader" id="walletBalancesLoader"></div></button>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">동시 조회 결과:</h3><pre id="walletBalancesResult"></pre></div>
                </div>
                 <div class="section-item-bordered">
                    <h2>스토어 업데이트 정보 확인</h2>
                    <button type="button" id="getStoreInfoButton" class="btn btn-secondary btn-full">정보 확인 <div class="loader" id="storeInfoLoader"></div></button>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">스토어 정보:</h3><pre id="storeInfoResult"></pre></div>
                </div>
                <div class="section-item-bordered">
                    <h2>트랜잭션 상세 정보 조회</h2>
                    <form id="txDetailsForm">
                        <div><label for="txHashInput">트랜잭션 해시:</label><input type="text" id="txHashInput" required placeholder="0x..."></div>
                        <div><label for="txDetailsNetworkSelect">네트워크:</label>
                            <select id="txDetailsNetworkSelect">
                                <option value="polygon" selected>Polygon Mainnet</option>
                                <option value="ethereum">Ethereum Mainnet</option>
                            </select>
                        </div>
                        <button type="submit" id="getTxDetailsButton" class="btn btn-info btn-full">상세 정보 조회 <div class="loader" id="txDetailsLoader"></div></button>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">트랜잭션 상세 정보:</h3><pre id="txDetailsResult"></pre></div>
                </div>
            </div>

            <div class="section">
                <div class="section-item">
                    <h2>네이티브 코인 전송</h2>
                    <p class="text-xs text-red-600 mb-3">* 로그인이 필요합니다.</p>
                    <form id="txForm">
                        <div><label for="txTo">받는 주소:</label><input type="text" id="txTo" required></div>
                        <div><label for="txValue">보낼 금액 (ETH/MATIC):</label><input type="text" id="txValue" required placeholder="예: 1.5"></div>
                        <div><label for="txNetwork">네트워크:</label>
                            <select id="txNetwork">
                                <option value="polygon" selected>Polygon Mainnet</option>
                                <option value="ethereum">Ethereum Mainnet</option>
                            </select>
                        </div>
                        <div class="flex-container mt-2">
                            <button type="button" id="estimateNativeFeeButton" disabled class="btn-secondary btn-flex-1" style="font-size: 0.8rem;">예상 수수료 <div class="loader" id="nativeFeeLoader"></div></button>
                            <button type="submit" id="sendTxButton" disabled class="btn-primary btn-flex-1" style="font-size: 0.8rem;">전송하기 <div class="loader" id="txLoader"></div></button>
                        </div>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">예상 수수료:</h3><pre id="nativeFeeResult"></pre></div>
                    <div class="mt-2"><h3 class="text-sm font-medium text-gray-600">전송 결과 (Tx 해시):</h3><pre id="txResult"></pre></div>
                </div>
                 <div class="section-item-bordered">
                    <h2>ERC20 토큰 전송</h2>
                    <p class="text-xs text-red-600 mb-3">* 로그인이 필요합니다.</p>
                    <form id="erc20Form">
                        <div><label for="erc20ContractAddress">토큰 컨트랙트 주소:</label><input type="text" id="erc20ContractAddress" required placeholder="0x..."></div>
                        <div><label for="erc20ToAddress">받는 주소:</label><input type="text" id="erc20ToAddress" required placeholder="0x..."></div>
                        <div><label for="erc20Amount">보낼 수량 (토큰 단위):</label><input type="text" id="erc20Amount" required placeholder="예: 10.5"><p class="mt-1 text-xs text-gray-500">서버에서 소수점을 처리합니다.</p></div>
                        <div><label for="erc20Network">네트워크:</label>
                            <select id="erc20Network">
                                <option value="polygon" selected>Polygon Mainnet</option>
                                <option value="ethereum">Ethereum Mainnet</option>
                            </select>
                        </div>
                        <div class="flex-container mt-2">
                            <button type="button" id="estimateErc20FeeButton" disabled class="btn-secondary btn-flex-1" style="font-size: 0.8rem;">예상 수수료 <div class="loader" id="erc20FeeLoader"></div></button>
                            <button type="submit" id="sendErc20Button" disabled class="btn-primary btn-flex-1" style="font-size: 0.8rem;">ERC20 전송 <div class="loader" id="erc20Loader"></div></button>
                        </div>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">예상 수수료:</h3><pre id="erc20FeeResult"></pre></div>
                    <div class="mt-2"><h3 class="text-sm font-medium text-gray-600">전송 결과 (Tx 해시):</h3><pre id="erc20Result"></pre></div>
                </div>
                 <div class="section-item-bordered">
                    <h2>비밀번호 변경</h2>
                    <p class="text-xs text-red-600 mb-3">* 로그인이 필요합니다.</p>
                    <form id="changePasswordForm">
                        <div><label for="currentPassword">현재 비밀번호:</label><input type="password" id="currentPassword" required></div>
                        <div><label for="newPassword">새 비밀번호:</label><input type="password" id="newPassword" required></div>
                        <div><label for="confirmNewPassword">새 비밀번호 확인:</label><input type="password" id="confirmNewPassword" required></div>
                        <button type="submit" id="changePasswordButton" disabled class="btn btn-primary btn-full">비밀번호 변경 <div class="loader" id="changePasswordLoader"></div></button>
                    </form>
                    <div class="mt-4"><h3 class="text-sm font-medium text-gray-600">변경 결과:</h3><pre id="changePasswordResult"></pre></div>
                </div>
                 <div class="section-item-bordered" style="background-color: #fee2e2; border-color: #fca5a5; padding: 1rem; border-radius: 0.5rem;">
                    <h2 style="color: #991b1b;">개인키 조회</h2>
                    <p style="color: #b91c1c;" class="text-sm font-medium mb-3">⚠️ 보안 경고: 개발/테스트용 기능입니다.</p>
                    <p class="text-xs text-red-600 mb-3">* 로그인이 필요합니다.</p>
                    <div id="privateKeySection">
                         <button type="button" id="getPrivateKeyButton" disabled class="btn btn-danger w-full md:w-auto">내 지갑 정보 조회 (위험!) <div class="loader" id="privateKeyLoader"></div></button>
                    </div>
                     <div class="mt-4">
                        <h3 class="text-sm font-medium text-gray-600">결과 (지갑 주소 & 개인키):</h3>
                        <pre id="privateKeyResult"></pre>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-6 border border-gray-200 p-4 rounded-lg bg-gray-50">
             <h2 class="text-lg font-semibold mb-2 text-gray-700">로그 / 오류 메시지</h2>
             <pre id="commonLog"></pre>
        </div>
    </div>

    <script>
        // --- 전역 상태 변수 ---
        let currentRequestId = 1;
        let authToken = null;
        let currentUserId = null;
        let currentUserAddress = null;

        // --- DOMContentLoaded 이벤트 리스너 ---
        document.addEventListener('DOMContentLoaded', () => {

            // --- DOM 요소 캐싱 ---
            const getEl = (id) => document.getElementById(id);
            const elements = {
                serverUrlInput: getEl('serverUrl'),
                loginStatusEl: getEl('loginStatus'),
                authTokenEl: getEl('authTokenDisplay'),
                userIdEl: getEl('userIdDisplay'),
                userAddressEl: getEl('userAddressDisplay'),
                // Forms & Sections
                registerForm: getEl('registerForm'),
                loginForm: getEl('loginForm'),
                balanceForm: getEl('balanceForm'),
                tokenInfoForm: getEl('tokenInfoForm'),
                txForm: getEl('txForm'),
                erc20Form: getEl('erc20Form'),
                erc20BalanceForm: getEl('erc20BalanceForm'),
                walletBalancesForm: getEl('walletBalancesForm'),
                changePasswordForm: getEl('changePasswordForm'),
                resetPasswordRequestForm: getEl('resetPasswordRequestForm'),
                resetPasswordForm: getEl('resetPasswordForm'),
                txDetailsForm: getEl('txDetailsForm'), // *** 추가됨 ***
                verificationSection: getEl('verificationSection'),
                resetVerificationSection: getEl('resetVerificationSection'),
                // Inputs & Status
                regNameInput: getEl('regName'), regPhoneInput: getEl('regPhone'), regEmailInput: getEl('regEmail'), regPasswordInput: getEl('regPassword'),
                verificationStatus: getEl('verificationStatus'), regVerificationCodeInput: getEl('regVerificationCode'),
                loginEmailInput: getEl('loginEmail'), loginPasswordInput: getEl('loginPassword'),
                balanceAddressInput: getEl('balanceAddress'), balanceNetworkSelect: getEl('balanceNetwork'),
                tokenInfoContractAddressInput: getEl('tokenInfoContractAddress'), tokenInfoNetworkSelect: getEl('tokenInfoNetwork'),
                txToInput: getEl('txTo'), txValueInput: getEl('txValue'), txNetworkSelect: getEl('txNetwork'),
                erc20ContractAddressInput: getEl('erc20ContractAddress'), erc20ToAddressInput: getEl('erc20ToAddress'), erc20AmountInput: getEl('erc20Amount'), erc20NetworkSelect: getEl('erc20Network'),
                erc20BalanceContractAddressInput: getEl('erc20BalanceContractAddress'), erc20BalanceNetworkSelect: getEl('erc20BalanceNetwork'),
                walletBalancesAddressInput: getEl('walletBalancesAddress'), walletBalancesContractAddressInput: getEl('walletBalancesContractAddress'), walletBalancesNetworkSelect: getEl('walletBalancesNetwork'),
                currentPasswordInput: getEl('currentPassword'), newPasswordInput: getEl('newPassword'), confirmNewPasswordInput: getEl('confirmNewPassword'),
                resetEmailInput: getEl('resetEmail'), resetVerificationStatus: getEl('resetVerificationStatus'), resetCodeInput: getEl('resetCode'), resetNewPasswordInput: getEl('resetNewPassword'),
                txHashInput: getEl('txHashInput'), // *** 추가됨 ***
                txDetailsNetworkSelect: getEl('txDetailsNetworkSelect'), // *** 추가됨 ***
                // Result Elements
                registerResultEl: getEl('registerResult'), loginResultEl: getEl('loginResult'), balanceResultEl: getEl('balanceResult'),
                tokenInfoResultEl: getEl('tokenInfoResult'), txResultEl: getEl('txResult'), erc20ResultEl: getEl('erc20Result'),
                nativeFeeResultEl: getEl('nativeFeeResult'), erc20FeeResultEl: getEl('erc20FeeResult'), erc20BalanceResultEl: getEl('erc20BalanceResult'),
                privateKeyResultEl: getEl('privateKeyResult'), walletBalancesResultEl: getEl('walletBalancesResult'), changePasswordResultEl: getEl('changePasswordResult'),
                resetResultEl: getEl('resetResult'), storeInfoResultEl: getEl('storeInfoResult'),
                txDetailsResultEl: getEl('txDetailsResult'), // *** 추가됨 ***
                commonLogEl: getEl('commonLog'),
                // Buttons
                requestCodeButton: getEl('requestCodeButton'), verifyCodeButton: getEl('verifyCodeButton'), registerSubmitButton: getEl('registerSubmitButton'),
                sendTxButton: getEl('sendTxButton'), sendErc20Button: getEl('sendErc20Button'), estimateNativeFeeButton: getEl('estimateNativeFeeButton'),
                estimateErc20FeeButton: getEl('estimateErc20FeeButton'), getTokenInfoButton: getEl('getTokenInfoButton'), getErc20BalanceButton: getEl('getErc20BalanceButton'),
                getPrivateKeyButton: getEl('getPrivateKeyButton'), getWalletBalancesButton: getEl('getWalletBalancesButton'), changePasswordButton: getEl('changePasswordButton'),
                requestResetCodeButton: getEl('requestResetCodeButton'), resetPasswordButton: getEl('resetPasswordButton'), getStoreInfoButton: getEl('getStoreInfoButton'),
                getTxDetailsButton: getEl('getTxDetailsButton'), // *** 추가됨 ***
                // Loaders
                loaders: {
                    register: getEl('registerLoader'), login: getEl('loginLoader'), balance: getEl('balanceLoader'),
                    tokenInfo: getEl('tokenInfoLoader'), tx: getEl('txLoader'), erc20: getEl('erc20Loader'),
                    nativeFee: getEl('nativeFeeLoader'), erc20Fee: getEl('erc20FeeLoader'), requestCode: getEl('requestCodeLoader'),
                    verifyCode: getEl('verifyCodeLoader'), erc20Balance: getEl('erc20BalanceLoader'), privateKey: getEl('privateKeyLoader'),
                    walletBalances: getEl('walletBalancesLoader'), changePassword: getEl('changePasswordLoader'),
                    resetCodeRequest: getEl('resetCodeRequestLoader'), resetPassword: getEl('resetPasswordLoader'),
                    storeInfo: getEl('storeInfoLoader'), txDetails: getEl('txDetailsLoader'), // *** 추가됨 ***
                }
            };

            // --- 유틸리티 함수 ---
            const toggleLoader = (loaderName, show) => { const loaderElement = elements.loaders[loaderName]; if (loaderElement) { loaderElement.style.display = show ? 'inline-block' : 'none'; } };
            const logMessage = (message, isError = false) => { if (!elements.commonLogEl) return; const timestamp = new Date().toLocaleTimeString(); const logEntry = document.createElement('div'); logEntry.textContent = `[${timestamp}] ${message}`; if (isError) logEntry.style.color = '#ef4444'; elements.commonLogEl.appendChild(logEntry); elements.commonLogEl.scrollTop = elements.commonLogEl.scrollHeight; };
            const clearResult = (element) => { if (element) element.textContent = ''; };
            const clearAllResults = () => { Object.values(elements).forEach(el => { if (el && el.tagName === 'PRE') clearResult(el); }); };
            const formatFeeDisplay = (feeData) => { if (!feeData || !feeData.totalFeeWei) return 'N/A'; try { const feeWei = BigInt(feeData.totalFeeWei); const feeEther = Number(feeWei) / 1e18; return `Gas: ${feeData.estimatedGas}\nPrice: ${feeData.gasPrice} Wei\nTotal: ${feeData.totalFeeWei} Wei\n(${feeEther.toFixed(8)} ETH/MATIC)`; } catch (e) { return '결과 표시 오류'; } };
            const formatBalance = (balanceWei, decimals) => { try { const balanceBigInt = BigInt(balanceWei); const decimalsNumber = Number(decimals); if (decimalsNumber === 0) return balanceBigInt.toString(); const factor = 10n ** BigInt(decimalsNumber); const integerPart = balanceBigInt / factor; const fractionalPart = (balanceBigInt % factor).toString().padStart(decimalsNumber, '0').replace(/0+$/, ''); return fractionalPart === '' ? integerPart.toString() : `${integerPart}.${fractionalPart}`; } catch (e) { console.error("Error formatting balance:", e); return "변환 오류"; } };

            const updateAuthStatusUI = () => {
                const isLoggedIn = !!authToken;
                elements.loginStatusEl.textContent = isLoggedIn ? '로그인됨' : '로그아웃';
                elements.loginStatusEl.classList.toggle('text-green-600', isLoggedIn);
                elements.loginStatusEl.classList.toggle('text-red-600', !isLoggedIn);
                elements.authTokenEl.textContent = authToken || '없음';
                elements.userIdEl.textContent = currentUserId || '없음';
                elements.userAddressEl.textContent = currentUserAddress || '없음';
                // 로그인 필요한 버튼 상태 업데이트
                elements.sendTxButton.disabled = !isLoggedIn;
                elements.sendErc20Button.disabled = !isLoggedIn;
                elements.estimateNativeFeeButton.disabled = !isLoggedIn;
                elements.estimateErc20FeeButton.disabled = !isLoggedIn;
                elements.getErc20BalanceButton.disabled = !isLoggedIn;
                elements.getPrivateKeyButton.disabled = !isLoggedIn;
                elements.changePasswordButton.disabled = !isLoggedIn;
            };

            // --- 핵심 RPC 통신 함수 ---
            async function sendRpcRequest(method, params = [], loaderName = null) {
                const serverUrl = elements.serverUrlInput.value; if (!serverUrl) { logMessage('서버 URL이 입력되지 않았습니다.', true); throw new Error('Server URL is not set.'); } const requestId = currentRequestId++; const requestBody = { jsonrpc: '2.0', method: method, params: params, id: requestId }; logMessage(`요청 보냄 (ID: ${requestId}, Method: ${method}): ${JSON.stringify(params)}`); if(loaderName) toggleLoader(loaderName, true); try { const response = await fetch(serverUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(requestBody) }); const responseData = await response.json(); if (!response.ok) { const errorMsg = responseData.error ? responseData.error.message : `HTTP 오류 ${response.status}`; throw new Error(errorMsg); } if (responseData.error) { logMessage(`RPC 오류 (ID: ${requestId}, Code: ${responseData.error.code}): ${responseData.error.message}`, true); throw new Error(`RPC Error (${responseData.error.code}): ${responseData.error.message}`); } logMessage(`응답 받음 (ID: ${requestId}): ${JSON.stringify(responseData.result)}`); return responseData.result; } catch (error) { logMessage(`요청 실패 (ID: ${requestId}): ${error.message}`, true); throw error; } finally { if(loaderName) toggleLoader(loaderName, false); }
            }

            // --- 이벤트 리스너 설정 ---

            // 사용자 등록 관련
            elements.requestCodeButton.addEventListener('click', async () => {
                const email = elements.regEmailInput.value; if (!email || !/\S+@\S+\.\S+/.test(email)) { logMessage('유효한 이메일을 입력하세요.', true); clearResult(elements.registerResultEl); elements.registerResultEl.textContent = '오류: 유효한 이메일을 입력하세요.'; return; } clearResult(elements.registerResultEl); elements.verificationStatus.textContent = '인증번호 요청 중...'; elements.verificationStatus.className = 'text-sm text-blue-600'; try { const result = await sendRpcRequest('requestEmailVerification', [email], 'requestCode'); logMessage(result.message || '인증번호 요청 성공 (이메일 확인)'); elements.verificationSection.classList.remove('hidden'); elements.verificationStatus.textContent = '이메일로 발송된 인증번호를 확인 후 입력하세요.'; elements.requestCodeButton.disabled = true; elements.verifyCodeButton.disabled = false; elements.regVerificationCodeInput.disabled = false; elements.registerSubmitButton.disabled = true; } catch (error) { elements.registerResultEl.textContent = `오류: ${error.message}`; elements.verificationStatus.textContent = '인증번호 요청 실패.'; elements.verificationStatus.className = 'text-sm text-red-600'; }
            });
            elements.verifyCodeButton.addEventListener('click', async () => {
                const email = elements.regEmailInput.value; const code = elements.regVerificationCodeInput.value; if (!code || code.length !== 4 || !/^\d{4}$/.test(code)) { logMessage('4자리 인증번호를 입력하세요.', true); clearResult(elements.registerResultEl); elements.registerResultEl.textContent = '오류: 4자리 숫자로 된 인증번호를 입력하세요.'; return; } clearResult(elements.registerResultEl); elements.verificationStatus.textContent = '인증번호 확인 중...'; elements.verificationStatus.className = 'text-sm text-blue-600'; try { const result = await sendRpcRequest('verifyEmailCode', [email, code], 'verifyCode'); logMessage(result.message || '이메일 인증 성공!'); elements.verificationStatus.textContent = '✅ 이메일 인증 완료!'; elements.verificationStatus.className = 'text-sm text-green-600'; elements.registerSubmitButton.disabled = false; elements.regVerificationCodeInput.disabled = true; elements.verifyCodeButton.disabled = true; elements.requestCodeButton.disabled = true; } catch (error) { elements.registerResultEl.textContent = `오류: ${error.message}`; elements.verificationStatus.textContent = '인증번호 확인 실패.'; elements.verificationStatus.className = 'text-sm text-red-600'; elements.registerSubmitButton.disabled = true; }
            });
            elements.registerForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.registerResultEl); const name = elements.regNameInput.value; const phone = elements.regPhoneInput.value; const email = elements.regEmailInput.value; const password = elements.regPasswordInput.value; try { const result = await sendRpcRequest('register', [name, phone, email, password], 'register'); elements.registerResultEl.textContent = JSON.stringify(result, null, 2); logMessage('사용자 등록 최종 성공!'); if(result.publicAddress) elements.balanceAddressInput.value = result.publicAddress; elements.verificationSection.classList.add('hidden'); elements.requestCodeButton.disabled = false; elements.regVerificationCodeInput.value = ''; elements.regVerificationCodeInput.disabled = true; elements.verifyCodeButton.disabled = true; elements.registerSubmitButton.disabled = true; elements.verificationStatus.textContent = ''; } catch (error) { elements.registerResultEl.textContent = `오류: ${error.message}`; elements.registerSubmitButton.disabled = true; }
            });

            // 사용자 로그인
            elements.loginForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.loginResultEl); const email = elements.loginEmailInput.value; const password = elements.loginPasswordInput.value; try { const result = await sendRpcRequest('login', [email, password], 'login'); elements.loginResultEl.textContent = JSON.stringify(result, null, 2); if (result.success && result.token) { authToken = result.token; currentUserId = result.userId; currentUserAddress = null; logMessage(`로그인 성공! 토큰: ${authToken}`); try { const walletInfo = await sendRpcRequest('getPrivateKey', [authToken]); if(walletInfo.publicAddress) { currentUserAddress = walletInfo.publicAddress; logMessage('사용자 지갑 주소 확인됨.'); } } catch (walletError) { logMessage('로그인 사용자의 지갑 주소를 가져오지 못했습니다.', true); } updateAuthStatusUI(); } else { authToken = null; currentUserId = null; currentUserAddress = null; updateAuthStatusUI(); } } catch (error) { elements.loginResultEl.textContent = `오류: ${error.message}`; authToken = null; currentUserId = null; currentUserAddress = null; updateAuthStatusUI(); }
            });

            // 잔액 조회
            elements.balanceForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.balanceResultEl); const address = elements.balanceAddressInput.value; const network = elements.balanceNetworkSelect.value; try { const result = await sendRpcRequest('eth_getBalance', [address, 'latest', network], 'balance'); const balanceInEther = formatBalance(result, 18); elements.balanceResultEl.textContent = `${result} Wei\n(${balanceInEther} ETH/MATIC)`; logMessage(`${address}의 잔액 조회 성공 (${network})`); } catch (error) { elements.balanceResultEl.textContent = `오류: ${error.message}`; }
            });

            // 토큰 정보 조회
            elements.tokenInfoForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.tokenInfoResultEl); const contractAddress = elements.tokenInfoContractAddressInput.value; const network = elements.tokenInfoNetworkSelect.value; try { const result = await sendRpcRequest('getTokenInfo', [contractAddress, network], 'tokenInfo'); elements.tokenInfoResultEl.textContent = `Name: ${result.name}\nSymbol: ${result.symbol}\nDecimals: ${result.decimals}`; logMessage(`토큰 정보 조회 성공 (${contractAddress} on ${network})`); } catch (error) { elements.tokenInfoResultEl.textContent = `오류: ${error.message}`; }
            });

            // 네이티브 코인 전송
            elements.txForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.txResultEl); if (!authToken) { logMessage('로그인 필요', true); elements.txResultEl.textContent = '오류: 로그인이 필요합니다.'; return; } const to = elements.txToInput.value; const valueEth = elements.txValueInput.value; const network = elements.txNetworkSelect.value; let valueWei; try { valueWei = parseUnits(valueEth, 18).toString(); } catch (err) { logMessage('금액 변환 오류: '+err.message, true); elements.txResultEl.textContent = '오류: 유효 금액 아님.'; return; } const txObject = { to: to, value: valueWei }; try { const result = await sendRpcRequest('eth_sendTransaction', [txObject, network, authToken, false], 'tx'); elements.txResultEl.textContent = `Tx 해시: ${result}`; logMessage(`네이티브 코인 전송 성공 (${network}), 해시: ${result}`); } catch (error) { elements.txResultEl.textContent = `오류: ${error.message}`; }
            });

            // 네이티브 코인 수수료 예측
            elements.estimateNativeFeeButton.addEventListener('click', async () => {
                clearResult(elements.nativeFeeResultEl); if (!authToken) { logMessage('로그인 필요', true); elements.nativeFeeResultEl.textContent = '오류: 로그인이 필요합니다.'; return; } const to = elements.txToInput.value; const valueEth = elements.txValueInput.value; const network = elements.txNetworkSelect.value; if (!to || !valueEth) { elements.nativeFeeResultEl.textContent = '오류: 받는 주소와 금액 입력 필요.'; return; } try { const result = await sendRpcRequest('estimateNativeFee', [to, valueEth, network, authToken], 'nativeFee'); elements.nativeFeeResultEl.textContent = formatFeeDisplay(result); logMessage(`네이티브 코인 예상 수수료 조회 성공 (${network})`); } catch (error) { elements.nativeFeeResultEl.textContent = `오류: ${error.message}`; }
            });

            // ERC20 토큰 전송
            elements.erc20Form.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.erc20ResultEl); if (!authToken) { logMessage('로그인 필요', true); elements.erc20ResultEl.textContent = '오류: 로그인이 필요합니다.'; return; } const contractAddress = elements.erc20ContractAddressInput.value; const toAddress = elements.erc20ToAddressInput.value; const amountString = elements.erc20AmountInput.value; const network = elements.erc20NetworkSelect.value; try { const result = await sendRpcRequest('sendErc20Token', [contractAddress, toAddress, amountString, network, authToken], 'erc20'); elements.erc20ResultEl.textContent = `Tx 해시: ${result}`; logMessage(`ERC20 토큰 전송 성공 (${network}), 해시: ${result}`); } catch (error) { elements.erc20ResultEl.textContent = `오류: ${error.message}`; }
            });

            // ERC20 토큰 수수료 예측
            elements.estimateErc20FeeButton.addEventListener('click', async () => {
                clearResult(elements.erc20FeeResultEl); if (!authToken) { logMessage('로그인 필요', true); elements.erc20FeeResultEl.textContent = '오류: 로그인이 필요합니다.'; return; } const contractAddress = elements.erc20ContractAddressInput.value; const toAddress = elements.erc20ToAddressInput.value; const amountString = elements.erc20AmountInput.value; const network = elements.erc20NetworkSelect.value; if (!contractAddress || !toAddress || !amountString) { elements.erc20FeeResultEl.textContent = '오류: 모든 필드 입력 필요.'; return; } try { const result = await sendRpcRequest('estimateErc20Fee', [contractAddress, toAddress, amountString, network, authToken], 'erc20Fee'); elements.erc20FeeResultEl.textContent = formatFeeDisplay(result); logMessage(`ERC20 토큰 예상 수수료 조회 성공 (${network})`); } catch (error) { elements.erc20FeeResultEl.textContent = `오류: ${error.message}`; }
            });

            // ERC20 토큰 잔액 조회
            elements.erc20BalanceForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.erc20BalanceResultEl); if (!authToken) { logMessage('로그인 필요', true); elements.erc20BalanceResultEl.textContent = '오류: 로그인이 필요합니다.'; return; } const contractAddress = elements.erc20BalanceContractAddressInput.value; const network = elements.erc20BalanceNetworkSelect.value; try { const result = await sendRpcRequest('getErc20Balance', [contractAddress, network, authToken], 'erc20Balance'); const formattedBal = formatBalance(result.balanceWei, result.decimals); elements.erc20BalanceResultEl.textContent = `Decimals: ${result.decimals}\nBalance (Wei): ${result.balanceWei}\nFormatted: ${formattedBal}`; logMessage(`ERC20 토큰 잔액 조회 성공 (${contractAddress} on ${network})`); } catch (error) { elements.erc20BalanceResultEl.textContent = `오류: ${error.message}`; }
            });

            // 지갑 잔액 동시 조회
            elements.walletBalancesForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.walletBalancesResultEl); const walletAddress = elements.walletBalancesAddressInput.value; const contractAddress = elements.walletBalancesContractAddressInput.value; const network = elements.walletBalancesNetworkSelect.value; if (!walletAddress || !contractAddress) { elements.walletBalancesResultEl.textContent = '오류: 조회할 지갑 주소와 토큰 컨트랙트 주소를 입력하세요.'; return; } try { const result = await sendRpcRequest('getWalletBalances', [walletAddress, contractAddress, network], 'walletBalances'); const nativeFormatted = formatBalance(result.nativeBalanceWei, 18); const tokenFormatted = formatBalance(result.tokenBalanceWei, result.tokenDecimals); elements.walletBalancesResultEl.textContent = `Native Balance: ${nativeFormatted} (Wei: ${result.nativeBalanceWei})\nToken Balance: ${tokenFormatted} (Wei: ${result.tokenBalanceWei}, Decimals: ${result.tokenDecimals})`; logMessage(`지갑 잔액 동시 조회 성공 (Address: ${walletAddress}, Token: ${contractAddress} on ${network})`); } catch (error) { elements.walletBalancesResultEl.textContent = `오류: ${error.message}`; }
            });

            // 개인키 조회
            elements.getPrivateKeyButton.addEventListener('click', async () => {
                clearResult(elements.privateKeyResultEl); if (!authToken) { logMessage('로그인 필요', true); elements.privateKeyResultEl.textContent = '오류: 로그인이 필요합니다.'; return; } if (!confirm('🚨 보안 경고! 개인키를 조회하시겠습니까? 이 키는 절대로 타인과 공유해서는 안 됩니다.')) { return; } try { const result = await sendRpcRequest('getPrivateKey', [authToken], 'privateKey'); elements.privateKeyResultEl.textContent = `Address: ${result.publicAddress || 'N/A'}\nPrivate Key: ${result.privateKey || 'N/A'}`; console.warn("🚨 SECURITY WARNING: Private key retrieved!", result.privateKey); logMessage('개인키 조회 완료 (보안에 각별히 주의하세요).'); } catch (error) { elements.privateKeyResultEl.textContent = `오류: ${error.message}`; }
            });

            // 비밀번호 변경
            elements.changePasswordForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.changePasswordResultEl); if (!authToken) { logMessage('로그인 필요', true); elements.changePasswordResultEl.textContent = '오류: 로그인이 필요합니다.'; return; } const currentPassword = elements.currentPasswordInput.value; const newPassword = elements.newPasswordInput.value; const confirmNewPassword = elements.confirmNewPasswordInput.value; if (!currentPassword || !newPassword || !confirmNewPassword) { elements.changePasswordResultEl.textContent = '오류: 모든 비밀번호 필드를 입력하세요.'; return; } if (newPassword !== confirmNewPassword) { elements.changePasswordResultEl.textContent = '오류: 새 비밀번호가 일치하지 않습니다.'; return; } try { const result = await sendRpcRequest('changePassword', [currentPassword, newPassword, authToken], 'changePassword'); elements.changePasswordResultEl.textContent = result.message || '성공적으로 변경되었습니다.'; logMessage('비밀번호 변경 성공'); elements.currentPasswordInput.value = ''; elements.newPasswordInput.value = ''; elements.confirmNewPasswordInput.value = ''; } catch (error) { elements.changePasswordResultEl.textContent = `오류: ${error.message}`; }
            });

            // 비밀번호 재설정 코드 요청
            elements.resetPasswordRequestForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.resetResultEl); const email = elements.resetEmailInput.value; if (!email || !/\S+@\S+\.\S+/.test(email)) { logMessage('유효한 이메일을 입력하세요.', true); elements.resetResultEl.textContent = '오류: 유효한 이메일을 입력하세요.'; return; } elements.resetVerificationStatus.textContent = '재설정 코드 요청 중...'; elements.resetVerificationSection.classList.add('hidden'); try { const result = await sendRpcRequest('requestPasswordReset', [email], 'resetCodeRequest'); logMessage(result.message || '재설정 코드 요청 성공 (이메일 확인)'); elements.resetVerificationSection.classList.remove('hidden'); elements.resetVerificationStatus.textContent = '이메일로 발송된 코드를 확인 후 아래에 입력하세요.'; elements.resetVerificationStatus.className = 'text-sm text-blue-600'; elements.requestResetCodeButton.disabled = true; } catch (error) { elements.resetResultEl.textContent = `오류: ${error.message}`; elements.resetVerificationStatus.textContent = '코드 요청 실패.'; elements.resetVerificationStatus.className = 'text-sm text-red-600'; }
            });

             // 비밀번호 재설정 실행
            elements.resetPasswordForm.addEventListener('submit', async (e) => {
                e.preventDefault(); clearResult(elements.resetResultEl); const email = elements.resetEmailInput.value; const code = elements.resetCodeInput.value; const newPassword = elements.resetNewPasswordInput.value; if (!email || !code || !newPassword || code.length !== 4 || !/^\d{4}$/.test(code)) { elements.resetResultEl.textContent = '오류: 이메일, 4자리 코드, 새 비밀번호를 모두 입력하세요.'; return; } try { const result = await sendRpcRequest('resetPassword', [email, code, newPassword], 'resetPassword'); elements.resetResultEl.textContent = result.message || '비밀번호가 성공적으로 재설정되었습니다.'; logMessage('비밀번호 재설정 성공'); elements.resetVerificationSection.classList.add('hidden'); elements.resetCodeInput.value = ''; elements.resetNewPasswordInput.value = ''; elements.resetEmailInput.value = ''; elements.requestResetCodeButton.disabled = false; } catch (error) { elements.resetResultEl.textContent = `오류: ${error.message}`; }
            });

            // 스토어 정보 조회
            elements.getStoreInfoButton.addEventListener('click', async () => {
                clearResult(elements.storeInfoResultEl);
                try {
                    const result = await sendRpcRequest('isupdatedstore', [], 'storeInfo');
                    const statusText = result.isNewStore ? '새 스토어 사용 가능 (업데이트 필요)' : '최신 버전 사용 중';
                    elements.storeInfoResultEl.textContent = `상태: ${statusText}\n새 URL: ${result.newUrl || '(없음)'}`;
                    logMessage('스토어 업데이트 정보 조회 성공');
                } catch (error) {
                    elements.storeInfoResultEl.textContent = `오류: ${error.message}`;
                }
            });

            // *** 트랜잭션 상세 정보 조회 추가 ***
            elements.txDetailsForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                clearResult(elements.txDetailsResultEl);
                const txHash = elements.txHashInput.value;
                const network = elements.txDetailsNetworkSelect.value;
                if (!txHash || !txHash.startsWith('0x') || txHash.length !== 66) {
                     elements.txDetailsResultEl.textContent = '오류: 유효한 트랜잭션 해시를 입력하세요 (0x로 시작하는 66자).';
                     return;
                }
                try {
                    const result = await sendRpcRequest('getTransactionDetails', [txHash, network], 'txDetails');
                    if (result === null) {
                        elements.txDetailsResultEl.textContent = '트랜잭션 또는 영수증을 찾을 수 없습니다.';
                    } else {
                        // 결과 객체를 보기 좋게 문자열로 변환하여 표시
                        elements.txDetailsResultEl.textContent = JSON.stringify(result, null, 2);
                    }
                    logMessage(`트랜잭션 상세 정보 조회 성공 (${txHash} on ${network})`);
                } catch (error) {
                    elements.txDetailsResultEl.textContent = `오류: ${error.message}`;
                }
            });


            // --- 초기화 ---
            updateAuthStatusUI();
            logMessage('클라이언트 초기화 완료.');

        }); // *** DOMContentLoaded 리스너 닫기 ***
    </script>
</body>
</html>
